# if sun elevation is less than -12, nighttime
sun_elev_deg < -12 ~ "night",
# if -12 <= elev <= 0) and before noon, 'dawn'
sun_elev_deg <= 0 & sun_elev_deg >= -12 & Begin_Hour_loc < 12 ~"dawn",
# if it's twilight (-12 <= elev <= 0) and after noon, 'dusk'
sun_elev_deg <= 0 & sun_elev_deg >= -12 & Begin_Hour_loc > 12 ~ "dusk"
))
library(suncalc)
all_ves_gmt8 <- all_sites_hp |>
filter(Dep == "DAMPIER_202009_DNE" |
Dep == "DAMPIER_202009_DSW" | Dep == "GEOGRAPHE_202201_GEO" | Dep == "JURIEN_202201_JNE"
| Dep == "JURIEN_202201_JSE"| Dep == "NINGALOO_201909_NGN"| Dep == "NINGALOO_201909_NGS"
| Dep == "SWC_202201_SWS"| Dep == "TWOROCKS_202105_TRE"| Dep == "TWOROCKS_202105_TRW") |>
mutate(Hr_local_tz = force_tz(Hr_local, tzone = "Etc/GMT-8"),
Begin_Date_UTC = as_date(with_tz(Hr_local_tz, tzone = "UTC")))|>
rowwise()|>
# get elevation of sun based on GPS location & time
mutate(sun_elev_rad = suncalc::getSunlightPosition(Hr_local_tz,
Lat_DD,
Lon_DD,
keep = "altitude")$altitude,
sun_elev_deg = (sun_elev_rad*180)/(pi),
twilight_times = getSunlightTimes(date = Begin_Date_UTC,
Lat_DD,
Lon_DD,
keep = c("nauticalDawn","sunset"),
tz = "UTC")) |>
mutate(nautDawn_UTC = twilight_times$nauticalDawn,
nautDawn_loc = with_tz(nautDawn_UTC, tzone = "Etc/GMT-8"),
sunset_UTC = twilight_times$sunset,
sunset_loc = with_tz(sunset_UTC, tzone = "Etc/GMT-8")) |>
mutate(
light_reg = case_when(
# if sun elev is positive, daytime
sun_elev_deg > 0 ~ "day",
# if sun elevation is less than -12, nighttime
sun_elev_deg < -12 ~ "night",
# if -12 <= elev <= 0) and before noon, 'dawn'
sun_elev_deg <= 0 & sun_elev_deg >= -12 & Begin_Hour_loc < 12 ~"dawn",
# if it's twilight (-12 <= elev <= 0) and after noon, 'dusk'
sun_elev_deg <= 0 & sun_elev_deg >= -12 & Begin_Hour_loc > 12 ~ "dusk"
))
# start by getting counts per light regime
all_ves_gmt10 <- all_sites_hp |>
filter(Dep == "CGMP_201807_CG" | Dep == "CGMP_201904_CG" | Dep == "SIMP_201808_EP" | Dep == "SIMP_201808_WP" |
Dep == "SIMP_201906_EP" | Dep == "SIMP_201906_WP" |
Dep == "MURAT_202002_MRE" | Dep == "MURAT_202002_MRW") |>
mutate(Hr_local_tz = force_tz(Hr_local, tzone = "Etc/GMT-10"),
Begin_Date_UTC = as_date(with_tz(Hr_local_tz, tzone = "UTC")))|>
rowwise()|>
# get elevation of sun based on GPS location & time
mutate(sun_elev_rad = suncalc::getSunlightPosition(Hr_local_tz,
Lat_DD,
Lon_DD,
keep = "altitude")$altitude,
sun_elev_deg = (sun_elev_rad*180)/(pi),
twilight_times = getSunlightTimes(date = Begin_Date_UTC,
Lat_DD,
Lon_DD,
keep = c("nauticalDawn","sunset"),
tz = "UTC")) |>
mutate(nautDawn_UTC = twilight_times$nauticalDawn,
nautDawn_loc = with_tz(nautDawn_UTC, tzone = "Etc/GMT-10"),
sunset_UTC = twilight_times$sunset,
sunset_loc = with_tz(sunset_UTC, tzone = "Etc/GMT-10")) |>
mutate(
light_reg = case_when(
# if sun elev is positive, daytime
sun_elev_deg > 0 ~ "day",
# if sun elevation is less than -12, nighttime
sun_elev_deg < -12 ~ "night",
# if -12 <= elev <= 0) and before noon, 'dawn'
sun_elev_deg <= 0 & sun_elev_deg >= -12 & Begin_Hour_loc < 12 ~"dawn",
# if it's twilight (-12 <= elev <= 0) and after noon, 'dusk'
sun_elev_deg <= 0 & sun_elev_deg >= -12 & Begin_Hour_loc > 12 ~ "dusk"
))
all_ves_gmt11 <- all_sites_hp |>
filter(Dep == "CGMP_201812_CG" |
Dep == "SIMP_201812_EP" | Dep == "SIMP_201812_WP") |>
mutate(Hr_local_tz = force_tz(Hr_local, tzone = "Etc/GMT-11"),
Begin_Date_UTC = as_date(with_tz(Hr_local_tz, tzone = "UTC")))|>
rowwise()|>
# get elevation of sun based on GPS location & time
mutate(sun_elev_rad = suncalc::getSunlightPosition(Hr_local_tz,
Lat_DD,
Lon_DD,
keep = "altitude")$altitude,
sun_elev_deg = (sun_elev_rad*180)/(pi),
twilight_times = getSunlightTimes(date = Begin_Date_UTC,
Lat_DD,
Lon_DD,
keep = c("nauticalDawn","sunset"),
tz = "UTC")) |>
mutate(nautDawn_UTC = twilight_times$nauticalDawn,
nautDawn_loc = with_tz(nautDawn_UTC, tzone = "Etc/GMT-11"),
sunset_UTC = twilight_times$sunset,
sunset_loc = with_tz(sunset_UTC, tzone = "Etc/GMT-11")) |>
mutate(
light_reg = case_when(
# if sun elev is positive, daytime
sun_elev_deg > 0 ~ "day",
# if sun elevation is less than -12, nighttime
sun_elev_deg < -12 ~ "night",
# if -12 <= elev <= 0) and before noon, 'dawn'
sun_elev_deg <= 0 & sun_elev_deg >= -12 & Begin_Hour_loc < 12 ~"dawn",
# if it's twilight (-12 <= elev <= 0) and after noon, 'dusk'
sun_elev_deg <= 0 & sun_elev_deg >= -12 & Begin_Hour_loc > 12 ~ "dusk"
))
#
#
# #suncalc package needs time zone
# mutate(
#   Hr_local_tz = case_when(
#   Dep == "CGMP_201807_CG" | Dep == "CGMP_201904_CG" | Dep == "SIMP_201808_EP" | Dep == "SIMP_201808_WP" |
#     Dep == "SIMP_201906_EP" | Dep == "SIMP_201906_WP" |
#     Dep == "MURAT_202002_MRE" | Dep == "MURAT_202002_MRW" ~ force_tz(Hr_local, tzone = "Etc/GMT-10")),
#   Hr_local_tz = case_when(
#   Dep == "CGMP_201812_CG" |
#     Dep == "SIMP_201812_EP" | Dep == "SIMP_201812_WP" ~ force_tz(Hr_local, tzone = "Etc/GMT-11")),
#   Hr_local_tz = case_when(
#   Dep == "DAMPIER_202009_DNE" |
#     Dep == "DAMPIER_202009_DSW" | Dep == "GEOGRAPHE_202201_GEO" | Dep == "JURIEN_202201_JNE"
#   | Dep == "JURIEN_202201_JSE"| Dep == "NINGALOO_201909_NGN"| Dep == "NINGALOO_201909_NGS"
#   | Dep == "SWC_202201_SWS"| Dep == "TWOROCKS_202105_TRE"| Dep == "TWOROCKS_202105_TRW" ~ force_tz(Hr_local, tzone = "Etc/GMT-8"))
#
#
#
#
#
# all_ves_light <- all_ves_light |>
#   rowwise()|>
#   mutate(nautDawn_UTC = twilight_times$nauticalDawn,
#          nautDawn_loc = with_tz(nautDawn_UTC, tzone = tz_local))
#
# ,
#          nautDusk_UTC = twilight_times$nauticalDusk,
#          nautDusk_loc = with_tz(nautDusk_UTC, tzone = tz_local)) |>
#
#   mutate(
#          light_reg = case_when(
#            sun_elev_deg > 0 ~ "day",
#            sun_elev_deg < -12 ~ "night",
#            sun_elev_deg <= 0 & sun_elev_deg >= -12 & Hr_local_tz > nautDawn_loc ~ "dawn",
#            TRUE ~ "dusk"
#          ))
#
#
#
#
#   group_by(network, npz_id, Dep_ID, Dep, Begin_Date_loc, Begin_Hour_loc)|>
#   # get daily vessel counts per weekday: total, inside, inside_small, maneuver, maneuver_small
#   summarise(Total_ves_dep = sum(Total_Vessels, na.rm = TRUE),
#             Total_inside = sum(total_inside, na.rm = TRUE),
#             Total_inside_small = sum(total_inside_small, na.rm = TRUE),
#             Inside_maneuver = sum(man_inside, na.rm = TRUE),
#             Inside_maneuver_small = sum(man_inside_small, na.rm = TRUE)) |>
#   mutate(Inside_transit = Total_inside - Inside_maneuver,
#          Inside_transit_small = Total_inside_small - Inside_maneuver_small,
#          network = case_when(npz_id == "CGMP" | npz_id == "SIMP" ~ "Temperate East",
#                              npz_id == "DMP" | npz_id == "NMP" ~ "Northwest", TRUE ~ "South-west"
#          ),
#          network = factor(network, levels = c("Temperate East","Northwest","South-west")))
#
#
# # Calculate daily mean-adjusted counts per hour
# daily_means_tot <- all_ves_diel |>
#   # group to date level
#   group_by(network, npz_id, Dep_ID, Dep, Begin_Date_loc) |>
#   # get n_hours per day
#   summarize(n_hrs = n(),
#             # and total vessels per day
#             day_sum = sum(Total_ves_dep, na.rm = TRUE)) |>
#   # only keep full days n_hrs == 24
#   # and days with vessels present
#   filter(n_hrs == 24,
#          day_sum >0) |>
#   # join to get hourly counts back
#   left_join(all_ves_diel) |>
#   # re-group to daily level
#   group_by(network, npz_id, Dep_ID, Dep, Begin_Date_loc) |>
#   # calculate mean total presence per day with vessels
#   mutate(mean_tot = mean(Total_ves_dep, na.rm = TRUE),
#          # calculate mean-adjusted counts per hour
#          tot_diel_adj = Total_ves_dep - mean_tot) |>
#   # group to hour level per deployment
#   group_by(network, npz_id, Dep_ID, Begin_Hour_loc) |>
#   # get mean of mean-adjusted ounts per hour
#   summarise(mean_diel_adj = mean(tot_diel_adj, na.rm =TRUE)) |>
#   # get lower & upper bounds for SD around mean of adjusted counts
#   mutate(sd_lower = mean_diel_adj - 0.5*(sd(mean_diel_adj)),
#          sd_upper = mean_diel_adj + 0.5*(sd(mean_diel_adj)))
#
#
#
# # Calculate daily mean-adjusted counts per hour for inside vessels
# daily_means_ins <- all_ves_diel |>
#   # group to date level
#   group_by(network, npz_id, Dep_ID, Dep, Begin_Date_loc) |>
#   # get n_hours per day
#   summarize(n_hrs = n(),
#             # and total vessels per day
#             day_sum = sum(Total_inside, na.rm = TRUE)) |>
#   # only keep full days n_hrs == 24
#   # and days with vessels present
#   filter(n_hrs == 24,
#          day_sum > 0) |>
#   # join to get hourly counts back
#   left_join(all_ves_diel) |>
#   # re-group to daily level
#   group_by(network, npz_id, Dep_ID, Dep, Begin_Date_loc) |>
#   # calculate mean total presence per day with vessels
#   mutate(mean_ins = mean(Total_inside, na.rm = TRUE),
#          # calculate mean-adjusted counts per hour
#          ins_diel_adj = Total_inside - mean_ins) |>
#   # group to hour level per deployment
#   group_by(network, npz_id, Dep_ID, Begin_Hour_loc) |>
#   # get mean of mean-adjusted ounts per hour
#   summarise(mean_diel_adj = mean(ins_diel_adj, na.rm =TRUE)) |>
#   # get lower & upper bounds for SD around mean of adjusted counts
#   mutate(sd_lower = mean_diel_adj - 0.5*(sd(mean_diel_adj)),
#          sd_upper = mean_diel_adj + 0.5*(sd(mean_diel_adj)))
#
#
#
# # Calculate diel mean-adusted counts for maneuvers
#
# daily_means_ins_man <- all_ves_diel |>
#   # group to date level
#   group_by(network, npz_id, Dep_ID, Dep, Begin_Date_loc) |>
#   # get n_hours per day
#   summarize(n_hrs = n(),
#             # and total vessels per day
#             day_sum = sum(Inside_maneuver, na.rm = TRUE)) |>
#   # only keep full days n_hrs == 24
#   # and days with vessels present
#   filter(n_hrs == 24,
#          day_sum > 0) |>
#   # join to get hourly counts back
#   left_join(all_ves_diel) |>
#   # re-group to daily level
#   group_by(network, npz_id, Dep_ID, Dep, Begin_Date_loc) |>
#   # calculate mean total presence per day with vessels
#   mutate(mean_ins_man = mean(Inside_maneuver, na.rm = TRUE),
#          # calculate mean-adjusted counts per hour
#          ins_diel_man_adj = Inside_maneuver - mean_ins_man) |>
#   # group to hour level per deployment
#   group_by(network, npz_id, Dep_ID, Begin_Hour_loc) |>
#   # get mean of mean-adjusted ounts per hour
#   summarise(mean_diel_man_adj = mean(ins_diel_man_adj, na.rm =TRUE)) |>
#   # get lower & upper bounds for SD around mean of adjusted counts
#   mutate(sd_lower = mean_diel_man_adj - 0.5*(sd(mean_diel_man_adj)),
#          sd_upper = mean_diel_man_adj + 0.5*(sd(mean_diel_man_adj)))
#
#
all_ves_light <- bind_rows(all_ves_gmt8, all_ves_gmt10, all_ves_gmt11)
View(all_ves_diel)
# merge separate dataframes back into single df with hourly counts
all_ves_light <- bind_rows(all_ves_gmt8, all_ves_gmt10, all_ves_gmt11) |>
# group by light regime per day
group_by(network, npz_id, Dep_ID, Dep, Begin_Date_loc, light_reg)|>
# get vessel counts per light regime per day: total, inside, inside_small, maneuver, maneuver_small
summarise(Total_ves_dep = sum(Total_Vessels, na.rm = TRUE),
Total_inside = sum(total_inside, na.rm = TRUE),
Total_inside_small = sum(total_inside_small, na.rm = TRUE),
Inside_maneuver = sum(man_inside, na.rm = TRUE),
Inside_maneuver_small = sum(man_inside_small, na.rm = TRUE)) |>
mutate(Inside_transit = Total_inside - Inside_maneuver,
Inside_transit_small = Total_inside_small - Inside_maneuver_small,
network = case_when(npz_id == "CGMP" | npz_id == "SIMP" ~ "Temperate East",
npz_id == "DMP" | npz_id == "NMP" ~ "Northwest", TRUE ~ "South-west"
),
network = factor(network, levels = c("Temperate East","Northwest","South-west")))
View(all_ves_light)
#             Inside_maneuver_small = sum(man_inside_small, na.rm = TRUE)) |>
#   mutate(Inside_transit = Total_inside - Inside_maneuver,
#          Inside_transit_small = Total_inside_small - Inside_maneuver_small,
#          network = case_when(npz_id == "CGMP" | npz_id == "SIMP" ~ "Temperate East",
#                              npz_id == "DMP" | npz_id == "NMP" ~ "Northwest", TRUE ~ "South-west"
#          ),
#          network = factor(network, levels = c("Temperate East","Northwest","South-west")))
#
#
# # Calculate daily mean-adjusted counts per light regime
light_means_tot <- all_ves_light |>
# group to date level
group_by(network, npz_id, Dep_ID, Dep, Begin_Date_loc) |>
# get n_hours per day
summarize(n_hrs = n(),
# and total vessels per day
day_sum = sum(Total_ves_dep, na.rm = TRUE)) |>
# only keep full days n_hrs == 24
# and days with vessels present
filter(n_hrs == 24,
day_sum >0) |>
# join to get counts by light regime back
left_join(all_ves_light) |>
# re-group to daily level
group_by(network, npz_id, Dep_ID, Dep, Begin_Date_loc) |>
# calculate mean total presence per day with vessels
mutate(mean_tot = mean(Total_ves_dep, na.rm = TRUE),
# calculate mean-adjusted counts per hour
tot_light_adj = Total_ves_dep - mean_tot) |>
# group to light level per deployment
group_by(network, npz_id, Dep_ID, light_reg) |>
# get mean of mean-adjusted ounts per hour
summarise(mean_light_adj = mean(tot_light_adj, na.rm =TRUE)) |>
# get lower & upper bounds for SD around mean of adjusted counts
mutate(sd_lower = mean_light_adj - 0.5*(sd(mean_light_adj)),
sd_upper = mean_light_adj + 0.5*(sd(mean_light_adj)))
ggplot(data = light_means_tot, aes(x = npz_id, y = mean_light_adj)) + geom_boxplot()
light_means_tot <- all_ves_light |>
# group to date level
group_by(network, npz_id, Dep_ID, Dep, Begin_Date_loc) |>
# get n_hours per day
summarize(n_hrs = n(),
# and total vessels per day
day_sum = sum(Total_ves_dep, na.rm = TRUE))
light_means_tot <- all_ves_light |>
# group to date level
group_by(network, npz_id, Dep_ID, Dep, Begin_Date_loc) |>
# get n_hours per day
summarize(n_hrs = n(),
# and total vessels per day
day_sum = sum(Total_ves_dep, na.rm = TRUE)) |>
# only keep full days n_hrs == 24
# and days with vessels present
filter(n_hrs == 24,
day_sum >0)
light_means_tot <- all_ves_light |>
# group to date level
group_by(network, npz_id, Dep_ID, Dep, Begin_Date_loc) |>
# get n_hours per day
summarize(n_hrs = n(),
# and total vessels per day
day_sum = sum(Total_ves_dep, na.rm = TRUE))
View(light_means_tot)
light_means_tot <- all_ves_light |>
# group to date level
group_by(network, npz_id, Dep_ID, Dep, Begin_Date_loc) |>
# get n_hours per day
summarize(n_light = n(),
# and total vessels per day
day_sum = sum(Total_ves_dep, na.rm = TRUE))
light_means_tot <- all_ves_light |>
# group to date level
group_by(network, npz_id, Dep_ID, Dep, Begin_Date_loc) |>
# get n_hours per day
summarize(n_light = n(),
# and total vessels per day
day_sum = sum(Total_ves_dep, na.rm = TRUE)) |>
# only keep days with all light regimes
# and days with vessels present
filter(n_light == 4,
day_sum >0)
all_ves_light <- bind_rows(all_ves_gmt8, all_ves_gmt10, all_ves_gmt11)
all_ves_light <- bind_rows(all_ves_gmt8, all_ves_gmt10, all_ves_gmt11) |>
# group to date level
group_by(network, npz_id, Dep_ID, Dep, Begin_Date_loc) |>
# get n_hours per day
summarize(n_hrs = n(),
# and total vessels per day
day_sum = sum(Total_ves_dep, na.rm = TRUE)) |>
# only keep full days n_hrs == 24
# and days with vessels present
filter(n_hrs == 24,
day_sum >0) |>
# join to get counts by light regime back
left_join(all_ves_light)
all_ves_light <- bind_rows(all_ves_gmt8, all_ves_gmt10, all_ves_gmt11) |>
# group to date level
group_by(network, npz_id, Dep_ID, Dep, Begin_Date_loc) |>
# get n_hours per day
summarize(n_hrs = n(),
# and total vessels per day
day_sum = sum(Total_vessels, na.rm = TRUE)) |>
# only keep full days n_hrs == 24
# and days with vessels present
filter(n_hrs == 24,
day_sum >0)
all_ves_light <- bind_rows(all_ves_gmt8, all_ves_gmt10, all_ves_gmt11) |>
# group to date level
group_by(network, npz_id, Dep_ID, Dep, Begin_Date_loc) |>
# get n_hours per day
summarize(n_hrs = n(),
# and total vessels per day
day_sum = sum(Total_Vessels, na.rm = TRUE)) |>
# only keep full days n_hrs == 24
# and days with vessels present
filter(n_hrs == 24,
day_sum >0)
View(all_ves_light)
all_ves_light <- bind_rows(all_ves_gmt8, all_ves_gmt10, all_ves_gmt11) |>
# group to date level
group_by(network, npz_id, Dep_ID, Dep, Begin_Date_loc) |>
# get n_hours per day
summarize(n_hrs = n(),
# and total vessels per day
day_sum = sum(Total_Vessels, na.rm = TRUE)) |>
# only keep full days n_hrs == 24
# and days with vessels present
filter(n_hrs == 24,
day_sum >0) |>
# join to get counts by light regime back
left_join(all_ves_light)
View(all_ves_light)
# merge separate dataframes back into single df with hourly counts
all_ves_light <- bind_rows(all_ves_gmt8, all_ves_gmt10, all_ves_gmt11) |>
# group by light regime per day
group_by(network, npz_id, Dep_ID, Dep, Begin_Date_loc, light_reg)|>
# get vessel counts per light regime per day: total, inside, inside_small, maneuver, maneuver_small
summarise(Total_ves_dep = sum(Total_Vessels, na.rm = TRUE),
Total_inside = sum(total_inside, na.rm = TRUE),
Total_inside_small = sum(total_inside_small, na.rm = TRUE),
Inside_maneuver = sum(man_inside, na.rm = TRUE),
Inside_maneuver_small = sum(man_inside_small, na.rm = TRUE)) |>
mutate(Inside_transit = Total_inside - Inside_maneuver,
Inside_transit_small = Total_inside_small - Inside_maneuver_small,
network = case_when(npz_id == "CGMP" | npz_id == "SIMP" ~ "Temperate East",
npz_id == "DMP" | npz_id == "NMP" ~ "Northwest", TRUE ~ "South-west"
),
network = factor(network, levels = c("Temperate East","Northwest","South-west")))
light_means_tot <- all_ves_light |>
# group to date level
group_by(network, npz_id, Dep_ID, Dep, Begin_Date_loc) |>
# get n_hours per day
summarize(n_hrs = n(),
# and total vessels per day
day_sum = sum(Total_ves_dep, na.rm = TRUE)) |>
# only keep full days n_hrs == 24
# and days with vessels present
filter( #n_hrs == 24,
day_sum >0)
light_means_tot <- all_ves_light |>
# group to date level
group_by(network, npz_id, Dep_ID, Dep, Begin_Date_loc) |>
# get n_hours per day
summarize(n_hrs = n(),
# and total vessels per day
day_sum = sum(Total_ves_dep, na.rm = TRUE)) |>
# only keep full days n_hrs == 24
# and days with vessels present
filter(n_hrs == 4,
day_sum >0)
#             Inside_maneuver_small = sum(man_inside_small, na.rm = TRUE)) |>
#   mutate(Inside_transit = Total_inside - Inside_maneuver,
#          Inside_transit_small = Total_inside_small - Inside_maneuver_small,
#          network = case_when(npz_id == "CGMP" | npz_id == "SIMP" ~ "Temperate East",
#                              npz_id == "DMP" | npz_id == "NMP" ~ "Northwest", TRUE ~ "South-west"
#          ),
#          network = factor(network, levels = c("Temperate East","Northwest","South-west")))
#
#
# # Calculate daily mean-adjusted counts per light regime
light_means_tot <- all_ves_light |>
# group to date level
group_by(network, npz_id, Dep_ID, Dep, Begin_Date_loc) |>
# get n_hours per day
summarize(n_hrs = n(),
# and total vessels per day
day_sum = sum(Total_ves_dep, na.rm = TRUE)) |>
# only keep days with all light conditions == 4 (dawn/day/dusk/night)
# and days with vessels present
filter(n_hrs == 4,
day_sum >0) |>
# join to get counts by light regime back
left_join(all_ves_light) |>
# re-group to daily level
group_by(network, npz_id, Dep_ID, Dep, Begin_Date_loc) |>
# calculate mean total presence per day with vessels
mutate(mean_tot = mean(Total_ves_dep, na.rm = TRUE),
# calculate mean-adjusted counts per hour
tot_light_adj = Total_ves_dep - mean_tot) |>
# group to light level per deployment
group_by(network, npz_id, Dep_ID, light_reg) |>
# get mean of mean-adjusted ounts per hour
summarise(mean_light_adj = mean(tot_light_adj, na.rm =TRUE)) |>
# get lower & upper bounds for SD around mean of adjusted counts
mutate(sd_lower = mean_light_adj - 0.5*(sd(mean_light_adj)),
sd_upper = mean_light_adj + 0.5*(sd(mean_light_adj)))
View(light_means_tot)
View(wkly_means_tot)
#             Inside_maneuver_small = sum(man_inside_small, na.rm = TRUE)) |>
#   mutate(Inside_transit = Total_inside - Inside_maneuver,
#          Inside_transit_small = Total_inside_small - Inside_maneuver_small,
#          network = case_when(npz_id == "CGMP" | npz_id == "SIMP" ~ "Temperate East",
#                              npz_id == "DMP" | npz_id == "NMP" ~ "Northwest", TRUE ~ "South-west"
#          ),
#          network = factor(network, levels = c("Temperate East","Northwest","South-west")))
#
#
# # Calculate daily mean-adjusted counts per light regime
light_mean_adj_tot <- all_ves_light |>
# group to date level
group_by(network, npz_id, Dep_ID, Dep, Begin_Date_loc) |>
# get n_hours per day
summarize(n_hrs = n(),
# and total vessels per day
day_sum = sum(Total_ves_dep, na.rm = TRUE)) |>
# only keep days with all light conditions == 4 (dawn/day/dusk/night)
# and days with vessels present
filter(n_hrs == 4,
day_sum >0) |>
# join to get counts by light regime back
left_join(all_ves_light) |>
# re-group to daily level
group_by(network, npz_id, Dep_ID, Dep, Begin_Date_loc) |>
# calculate mean total presence per day with vessels
mutate(mean_tot = mean(Total_ves_dep, na.rm = TRUE),
# calculate mean-adjusted counts per hour
tot_light_adj = Total_ves_dep - mean_tot)
ggplot(data = light_mean_adj_tot, aes(x = npz_id, y = tot_light_adj)) + geom_boxplot()
ggplot(data = light_mean_adj_tot, aes(x = npz_id, y = tot_light_adj)) + geom_boxplot(aes(color = light_reg))
