mutate(ins_out_prop = Total_inside_ves_dep / Total_ves_dep)
# Total vessels
#
# Plot: x-axis = sites, y-axis = proportion hours with vessel present (single value)
#
# Proportion presence for total deployment
all_ves_prop_hrs <- all_sites_hp |>
# group by Begin Hour to collapse into hours
group_by(SiteID, ves_yn) |>
# get total number of hours for Y and N groups per each hour per deployment
summarize(n_hours = n())|>
mutate(freq = n_hours/sum(n_hours)) |>
ungroup() |>
complete(SiteID, ves_yn,
fill = list(ves_yn = "Y", freq = 0)) |>
group_by(SiteID, ves_yn) |>
# reshape for easier plotting
pivot_longer(cols = c("freq"),
values_to = "Perc_per_hour")
# Vessels inside parks
ins_ves_prop_hrs <- all_sites_hp |>
# group by Begin Hour to collapse into hours
group_by(SiteID, ins_ves_yn) |>
# get total number of hours for Y and N groups per each hour per deployment
summarize(n_hours = n())|>
mutate(freq = n_hours/sum(n_hours)) |>
ungroup() |>
complete(SiteID, ins_ves_yn,
fill = list(ins_ves_yn = "Y", freq = 0)) |>
group_by(SiteID, ins_ves_yn) |>
# reshape for easier plotting
pivot_longer(cols = c("freq"),
values_to = "Perc_per_hour")
# Proportion of 'vessel hours' with inside vessels over whole deployment
# Plot: x-axis = site, y-axis = proportion vessel hours with inside vessels (single value)
ins_ves_prop_allves <- all_sites_hp |>
# group by Begin Hour to collapse into hours
group_by(SiteID, ves_yn, ins_ves_yn) |>
# get total number of hours for Y and N groups per each hour per deployment
summarize(n_hours = n())|>
mutate(freq = n_hours/sum(n_hours)) |>
ungroup() |>
complete(SiteID, ins_ves_yn,
fill = list(ins_ves_yn = "Y", freq = 0)) |>
group_by(SiteID, ins_ves_yn) |>
# reshape for easier plotting
pivot_longer(cols = c("freq"),
values_to = "Perc_per_hour")
all_diel_perc <- all_sites_hp |>
# group by Begin Hour to collapse into hours
group_by(SiteID, Begin_Hour_loc, ves_yn) |>
# get total number of hours for Y and N groups per each hour per deployment
summarize(n_hours = n())|>
mutate(freq = n_hours/sum(n_hours)) |>
ungroup() |>
complete(SiteID, Begin_Hour_loc, ves_yn,
fill = list(ves_yn = "Y", freq = 0)) |>
group_by(SiteID, Begin_Hour_loc, ves_yn) |>
# reshape for easier plotting
pivot_longer(cols = c("freq"),
values_to = "Perc_per_hour")
# of hours with acoustically detected vessels, __% had presence inside the park
ins_diel_perc <- all_sites_hp |>
# group by Begin Hour to collapse into hours
group_by(SiteID, Begin_Hour_loc, ves_yn, ins_ves_yn) |>
# get total number of hours for Y and N groups per each hour per deployment
summarize(n_hours = n())|>
mutate(freq = n_hours/sum(n_hours)) |>
ungroup() |>
complete(SiteID, ins_ves_yn,
fill = list(ins_ves_yn = "Y", freq = 0)) |>
group_by(SiteID, ins_ves_yn) |>
# reshape for easier plotting
pivot_longer(cols = c("freq"),
values_to = "Perc_per_hour")
# Plot: x-axis = weekday, y-axis = median +/- 25th - 75th percentiles (single value)
#
# count up total vessels and vessels inside parks
all_ves_by_weekday <- all_sites_hp |>
group_by(SiteID, Date_noyr, Weekday) |>
summarise(n_days = n_distinct(Date_noyr),
Total_ves_dep = sum(Total_Vessels, na.rm = TRUE),
Total_ves_per_day = Total_ves_dep/n_days,
Total_inside_ves_dep = sum(total_inside, na.rm = TRUE),
Total_inside_ves_per_day = Total_inside_ves_dep/n_days) |>
mutate(Weekday = factor(Weekday, levels=c("Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday")))
levels(all_ves_by_weekday$Weekday) <- c("M","T","W","R","F","Sa","Su")
weekday_summary <- all_ves_by_weekday |>
group_by(SiteID, Weekday) |>
summarise(total_weekday = sum(Total_ves_dep),
median_ves_weekday = median(Total_ves_dep),
weekday_lower = quantile(Total_ves_dep, 0.25),
weekday_upper = quantile(Total_ves_dep, 0.75),
total_ins_weekday = sum(Total_inside_ves_dep),
median_ins_ves_weekday = median(Total_inside_ves_dep),
weekday_ins_lower = quantile(Total_inside_ves_dep, 0.25),
weekday_ins_upper = quantile(Total_inside_ves_dep, 0.75)) |>
mutate(Weekday = factor(Weekday, levels=c("Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday")))
levels(all_ves_by_weekday$Weekday) <- c("M","T","W","R","F","Sa","Su")
all_perc_weekday <- all_sites_hp |>
# group by date
group_by(SiteID, Date_noyr, Weekday, ves_yn) |>
# get total number of hours for Y and N groups per each hour per deployment
summarize(n_hours = n())|>
mutate(freq = n_hours/sum(n_hours)) |>
ungroup() |>
complete(SiteID, Weekday, ves_yn,
fill = list(ves_yn = "Y", freq = 0)) |>
group_by(SiteID, Weekday, ves_yn) |>
# reshape for easier plotting
pivot_longer(cols = c("freq"),
values_to = "Perc_per_hour")
weekly_ves <- all_sites_hp |>
mutate(day_index = yday(Begin_Date_loc),
iso_week = isoweek(Begin_Date_loc)) |>
group_by(network, SiteID, iso_week) |>
summarize(mean_ves = mean(Total_Vessels, na.rm = TRUE),
med_ves = median(Total_Vessels, na.rm = TRUE),
sd_ves = sd(Total_Vessels, na.rm = TRUE),
sd_lower = mean_ves - (0.5*sd_ves),
sd_upper = mean_ves + (0.5*sd_ves))
daily_ves <- all_sites_hp |>
group_by(network, SiteID, day_index) |>
summarize(mean_ves = mean(Total_Vessels, na.rm = TRUE),
med_ves = median(Total_Vessels, na.rm = TRUE),
sd_ves = sd(Total_Vessels, na.rm = TRUE),
sd_lower = mean_ves - (0.5*sd_ves),
sd_upper = mean_ves + (0.5*sd_ves))
# make list of site labels for plotting
site_labs <- as_labeller(
c("Cod Grounds" = "Cod Grounds",
"DNE" = "Dampier",
"EP" = "Solitary \nIslands",
"MRE" = "Murat",
"NGN" = "Ningaloo",
"SWC" = "South-west \nCorner",
"TRW D1" = "Two Rocks",
"JNE" = "Jurien",
"GEO" = "Geographe"))
# test plot to check whether weekday ordering worked
ggplot(data = weekday_summary,
mapping = aes(x = Weekday,
y = median_ves_weekday)) +
geom_col() +
geom_linerange(aes(ymin = weekday_lower,
ymax = weekday_upper))+
facet_wrap(~SiteID) +
theme_bw()
# test plot to check whether weekday ordering worked
ggplot(data = all_ves_by_weekday,
mapping = aes(x = Weekday,
y = Total_ves_dep)) +
geom_boxplot()+
# geom_ribbon(aes(ymin = weekday_lower,
#                 ymax = weekday_upper),
#             fill = "grey75")+
# geom_linerange(aes(ymin = weekday_lower,
#                    ymax = weekday_upper))+
# geom_line() +
# geom_point() +
facet_wrap(~SiteID, scales = "free_y") +
theme_bw()
ggsave("Figures/weekday_by_site_boxplot.jpg", device = "jpeg",
width=10, height=8, units="in", dpi=300)
### Weekday inside
# test plot to check whether weekday ordering worked
ggplot(data = weekday_summary,
mapping = aes(x = Weekday,
y = median_ins_ves_weekday)) +
geom_col() +
geom_linerange(aes(ymin = weekday_ins_lower,
ymax = weekday_ins_upper))+
facet_wrap(~SiteID) +
theme_bw()
# Save figure
ggsave("Figures/inside_weekday_by_site_qt25-75_line.jpg", device = "jpeg",
width=10, height=8, units="in", dpi=300)
### Weekday inside
# test plot to check whether weekday ordering worked
ggplot(data = weekday_summary,
mapping = aes(x = Weekday,
y = median_ins_ves_weekday)) +
geom_boxplot() +
# geom_linerange(aes(ymin = weekday_ins_lower,
#                    ymax = weekday_ins_upper))+
facet_wrap(~SiteID) +
theme_bw()
View(weekday_summary)
### Weekday inside
# test plot to check whether weekday ordering worked
ggplot(data = all_ves_by_weekday,
mapping = aes(x = Weekday,
y = Total_inside_ves_per_day)) +
geom_boxplot() +
# geom_linerange(aes(ymin = weekday_ins_lower,
#                    ymax = weekday_ins_upper))+
facet_wrap(~SiteID) +
theme_bw()
# Save figure
ggsave("Figures/inside_weekday_by_site_boxplot.jpg", device = "jpeg",
width=10, height=8, units="in", dpi=300)
#### Polar plot diel ####
ggplot(data = all_diel_perc |>
filter(ves_yn=="Y"), # only plot 'yes' proportions
aes(x=Begin_Hour_loc,
y = Perc_per_hour,
fill = Perc_per_hour,))+
geom_line(aes(group = SiteID))+
coord_polar(theta = "x", start = 0) +
# scale_fill_viridis_c(labels = label_number(accuracy = 0.01),
#                      begin = 0, end = 1, limits = c(0,1),
#                      breaks = c(0,0.25,0.5,0.75,1),
#                      option = "B")+
scale_x_continuous(breaks=seq(0,23,4),
minor_breaks = seq(0:23),
expand = c(0,0)) +
# scale_y_continuous(limits=c(0,1),
#                    breaks=seq(0,1,0.25),
#                    expand = c(0, 0)) +
ylab("N hours present / Total deployment Hours") +
# ylim(0,1)+
xlab("Hour")+
theme(text=element_text(size=20),
strip.background = element_rect(color = "white", fill = "black"),
strip.text.x = element_text(colour = "white", face = "bold"),
strip.text.y = element_text(colour = "white", face = "bold"),
plot.title = element_text(hjust = 0.5))+
#R turns the proportion values into bins in the legend when I change the title, so I'm removing it instead
theme(legend.title=element_blank()) +
facet_wrap(facets = vars(SiteID), nrow = 3,
scales = "free_y")
ggplot(all_sites_hp,
aes(x = day_index,
y = Begin_Hour_loc,
fill= Total_Vessels)) +
geom_tile()+
scale_fill_viridis_c()+
facet_grid(rows = vars(SiteID), scales = "free_x")+
ylab("Begin Hour")+
xlab("Julian Day")+
ggtitle("Vessel Activity")+
# scale_x_date(
#   name="Julian Day",
#   date_breaks="1 month",
#   date_labels="%b",
#   expand=expansion(0,0))+
theme(text=element_text(size=18),
strip.background = element_rect(color = "white", fill = "black"),
strip.text.x = element_text(colour = "white", face = "bold"),
strip.text.y = element_text(colour = "white", face = "bold"),
plot.title = element_text(hjust = 0.5))
ggplot(all_sites_hp,
aes(x = Date_noyr,
y = Begin_Hour_loc,
fill= Total_Vessels)) +
geom_tile()+
scale_fill_viridis_c()+
facet_grid(rows = vars(SiteID), scales = "free_x")+
ylab("Begin Hour")+
xlab("Date")+
ggtitle("Vessel Activity")+
# scale_x_date(
#   name="Julian Day",
#   date_breaks="1 month",
#   date_labels="%b",
#   expand=expansion(0,0))+
theme(text=element_text(size=18),
strip.background = element_rect(color = "white", fill = "black"),
strip.text.x = element_text(colour = "white", face = "bold"),
strip.text.y = element_text(colour = "white", face = "bold"),
plot.title = element_text(hjust = 0.5))
ggplot(all_sites_hp,
aes(x = Date_noyr |> filter(SiteID == "JNE"),
y = Begin_Hour_loc,
fill= Total_Vessels)) +
geom_tile()+
scale_fill_viridis_c()+
facet_grid(rows = vars(SiteID), scales = "free_x")+
ylab("Begin Hour")+
xlab("Date")+
ggtitle("Vessel Activity")+
# scale_x_date(
#   name="Julian Day",
#   date_breaks="1 month",
#   date_labels="%b",
#   expand=expansion(0,0))+
theme(text=element_text(size=18),
strip.background = element_rect(color = "white", fill = "black"),
strip.text.x = element_text(colour = "white", face = "bold"),
strip.text.y = element_text(colour = "white", face = "bold"),
plot.title = element_text(hjust = 0.5))
ggplot(all_sites_hp|> filter(SiteID == "JNE"),
aes(x = Date_noyr ,
y = Begin_Hour_loc,
fill= Total_Vessels)) +
geom_tile()+
scale_fill_viridis_c()+
facet_grid(rows = vars(SiteID), scales = "free_x")+
ylab("Begin Hour")+
xlab("Date")+
ggtitle("Vessel Activity")+
# scale_x_date(
#   name="Julian Day",
#   date_breaks="1 month",
#   date_labels="%b",
#   expand=expansion(0,0))+
theme(text=element_text(size=18),
strip.background = element_rect(color = "white", fill = "black"),
strip.text.x = element_text(colour = "white", face = "bold"),
strip.text.y = element_text(colour = "white", face = "bold"),
plot.title = element_text(hjust = 0.5))
ggplot(all_sites_hp|> filter(SiteID == "GEO"),
aes(x = Date_noyr ,
y = Begin_Hour_loc,
fill= Total_Vessels)) +
geom_tile()+
scale_fill_viridis_c()+
facet_grid(rows = vars(SiteID), scales = "free_x")+
ylab("Begin Hour")+
xlab("Date")+
ggtitle("Vessel Activity")+
# scale_x_date(
#   name="Julian Day",
#   date_breaks="1 month",
#   date_labels="%b",
#   expand=expansion(0,0))+
theme(text=element_text(size=18),
strip.background = element_rect(color = "white", fill = "black"),
strip.text.x = element_text(colour = "white", face = "bold"),
strip.text.y = element_text(colour = "white", face = "bold"),
plot.title = element_text(hjust = 0.5))
# Save figure
ggsave("Figures/Diel_GEO_heatmap.jpg", device = "jpeg",
width=10, height=8, units="in", dpi=300)
ggplot(all_sites_hp,
aes(x = Date_noyr ,
y = Begin_Hour_loc,
fill= Total_Vessels)) +
geom_tile()+
scale_fill_viridis_c()+
facet_grid(rows = vars(SiteID), scales = "free_x")+
ylab("Begin Hour")+
xlab("Date")+
ggtitle("Vessel Activity")+
# scale_x_date(
#   name="Julian Day",
#   date_breaks="1 month",
#   date_labels="%b",
#   expand=expansion(0,0))+
theme(text=element_text(size=18),
strip.background = element_rect(color = "white", fill = "black"),
strip.text.x = element_text(colour = "white", face = "bold"),
strip.text.y = element_text(colour = "white", face = "bold"),
plot.title = element_text(hjust = 0.5))
# Save figure
ggsave("Figures/Diel_allsites_heatmap.jpg", device = "jpeg",
width=10, height=8, units="in", dpi=300)
# ggtitle("Vessel Activity")+
# scale_x_date(
#   name="Julian Day",
#   date_breaks="1 month",
#   date_labels="%b",
#   expand=expansion(0,0))+
theme(text=element_text(size=18),
plot.title = element_text(hjust = 0.5)
y = Total_Vessels)) +
# boxplot diel
ggplot(all_sites_hp,
# boxplot diel
ggplot(data = all_sites_hp,
aes(x = Begin_Hour_loc,
y = Total_Vessels)) +
geom_boxplot()+
# scale_fill_viridis_c()+
facet_grid(rows = vars(SiteID), scales = "free_x")+
xlab("Begin Hour")+
xlab("Total Vessels")+
theme(text=element_text(size=18),
strip.background = element_rect(color = "white", fill = "black"),
strip.text.x = element_text(colour = "white", face = "bold"),
strip.text.y = element_text(colour = "white", face = "bold"),
plot.title = element_text(hjust = 0.5))
# boxplot diel
ggplot(data = all_sites_hp,
aes(x = Begin_Hour_loc,
y = Total_Vessels,
group = SiteID)) +
geom_boxplot()+
# scale_fill_viridis_c()+
facet_grid(rows = vars(SiteID), scales = "free_x")+
xlab("Begin Hour")+
xlab("Total Vessels")+
theme(text=element_text(size=18),
strip.background = element_rect(color = "white", fill = "black"),
strip.text.x = element_text(colour = "white", face = "bold"),
strip.text.y = element_text(colour = "white", face = "bold"),
plot.title = element_text(hjust = 0.5))
# boxplot diel
ggplot(data = all_sites_hp,
aes(x = as_factor(Begin_Hour_loc),
y = Total_Vessels)) +
geom_boxplot()+
# scale_fill_viridis_c()+
facet_grid(rows = vars(SiteID), scales = "free_x")+
xlab("Begin Hour")+
xlab("Total Vessels")+
theme(text=element_text(size=18),
strip.background = element_rect(color = "white", fill = "black"),
strip.text.x = element_text(colour = "white", face = "bold"),
strip.text.y = element_text(colour = "white", face = "bold"),
plot.title = element_text(hjust = 0.5))
# boxplot diel
ggplot(data = all_sites_hp,
aes(x = as_factor(Begin_Hour_loc),
y = Total_Vessels)) +
geom_boxplot()+
# scale_fill_viridis_c()+
facet_grid(vars(SiteID), scales = "free_x")+
xlab("Begin Hour")+
xlab("Total Vessels")+
theme(text=element_text(size=18),
strip.background = element_rect(color = "white", fill = "black"),
strip.text.x = element_text(colour = "white", face = "bold"),
strip.text.y = element_text(colour = "white", face = "bold"),
plot.title = element_text(hjust = 0.5))
# boxplot diel
ggplot(data = all_sites_hp,
aes(x = as_factor(Begin_Hour_loc),
y = Total_Vessels)) +
geom_bar()+
# scale_fill_viridis_c()+
facet_grid(vars(SiteID), scales = "free_x")+
xlab("Begin Hour")+
xlab("Total Vessels")+
theme(text=element_text(size=18),
strip.background = element_rect(color = "white", fill = "black"),
strip.text.x = element_text(colour = "white", face = "bold"),
strip.text.y = element_text(colour = "white", face = "bold"),
plot.title = element_text(hjust = 0.5))
# boxplot diel
ggplot(data = all_sites_hp,
aes(x = Begin_Hour_loc,
y = Total_Vessels)) +
geom_bar()+
# scale_fill_viridis_c()+
facet_grid(vars(SiteID), scales = "free_x")+
xlab("Begin Hour")+
xlab("Total Vessels")+
theme(text=element_text(size=18),
strip.background = element_rect(color = "white", fill = "black"),
strip.text.x = element_text(colour = "white", face = "bold"),
strip.text.y = element_text(colour = "white", face = "bold"),
plot.title = element_text(hjust = 0.5))
#### Inside vessels ####
# Add some inside/outside columns
all_ves_in_out <- all_sites_hp |>
mutate(trans_inside = replace_na(trans_inside, 0),
man_inside = replace_na(man_inside, 0),
total_inside = replace_na(total_inside, 0),
total_outside = Total_Vessels - total_inside)#|>
# reshape for stacked bar plot
# Add some inside/outside columns
ins_ves_by_site <- all_ves_by_site |>
mutate(Outside = Total_ves_dep - Total_inside_ves_dep) |>
rename("Inside" = "Total_inside_ves_dep") |>
pivot_longer(cols = c("Outside","Inside"),
names_to = "Total_ins_out",
values_to = "Total")
ins_diel_perc <- all_ves_in_out |>
mutate(ins_yn = ifelse(total_inside == 0, "N","Y"))|>
# group by Begin Hour to collapse into hours
group_by(SiteID, Begin_Hour_loc, ins_yn) |>
# get total number of hours for Y and N groups per each hour per deployment
summarize(n_hours = n())|>
mutate(freq = n_hours/sum(n_hours)) |>
ungroup() |>
complete(SiteID, Begin_Hour_loc, ins_yn,
fill = list(ins_yn = "Y", freq = 0)) |>
group_by(SiteID, Begin_Hour_loc, ins_yn) |>
# reshape for easier plotting
pivot_longer(cols = c("freq"),
values_to = "Perc_per_hour")
#### INSIDE Polar plot diel ####
ggplot(data=ins_diel_perc |>
filter(ins_yn=="Y"), # only plot 'yes' proportions
aes(x=Begin_Hour_loc,
y = Perc_per_hour,
fill = Perc_per_hour,))+
geom_bar(stat="identity")+
coord_polar(theta = "x", start = 0) +
scale_fill_viridis_c(labels = label_number(accuracy = 0.01),
begin = 0, end = 1, limits = c(0,1),
breaks = c(0,0.25,0.5,0.75,1),
option = "B")+
scale_x_continuous(breaks=seq(0,23,4),
minor_breaks = seq(0:23),
expand = c(0,0)) +
# scale_y_continuous(limits=c(0,1),
#                    breaks=seq(0,1,0.25),
#                    expand = c(0, 0)) +
ylab("N hours present inside / Total deployment Hours") +
# ylim(0,1)+
xlab("Hour")+
theme(text=element_text(size=20),
strip.background = element_rect(color = "white", fill = "black"),
strip.text.x = element_text(colour = "white", face = "bold"),
strip.text.y = element_text(colour = "white", face = "bold"),
plot.title = element_text(hjust = 0.5))+
#R turns the proportion values into bins in the legend when I change the title, so I'm removing it instead
theme(legend.title=element_blank()) +
facet_wrap(facets = vars(SiteID), nrow = 3,
scales = "free_y")
