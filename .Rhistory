Total_inside = sum(total_inside, na.rm = TRUE),
Total_inside_small = sum(total_inside_small, na.rm = TRUE),
Inside_maneuver = sum(man_inside, na.rm = TRUE),
Inside_maneuver_small = sum(man_inside_small, na.rm = TRUE)) |>
mutate(Inside_transit = Total_inside - Inside_maneuver,
Inside_transit_small = Total_inside_small - Inside_maneuver_small) |>
filter(Total_ves_dep > 0)
wkdy_prop_table <- all_ves_wkdy |>
summarise(frequency = n())
View(wkdy_prop_table)
10+12+12+50+100+50+50
10/284
12/284
50/284
100/284
1/7
wkdy_prop_table <- all_ves_wkdy |>
group_by(network, npz_id, Site_ID, Dep, Weekday) |>
mutate(tot_wkday_prop = Total_ves_dep/sum(Total_ves_dep))
View(wkdy_prop_table)
wkdy_prop_table <- all_ves_wkdy |>
group_by(network, npz_id, Site_ID, Dep) |>
mutate(tot_wkday_prop = Total_ves_dep/sum(Total_ves_dep))
View(wkdy_prop_table)
27+13+14+13+30+18+23
27/138
13/138
# function to calculate Wald interval
# from https://towardsdatascience.com/five-confidence-intervals-for-proportions-that-you-should-know-about-7ff5484c024f
waldInterval <- function(x, n, conf.level = 0.95){
p <- x/n
sd <- sqrt(p*((1-p)/n))
z <- qnorm(c( (1—conf.level)/2, 1—(1-conf.level)/2)) #returns the value of thresholds at which conf.level has to be cut at. for 95% CI, this is -1.96 and +1.96
# function to calculate Agresti-Coull interval
# from https://towardsdatascience.com/five-confidence-intervals-for-proportions-that-you-should-know-about-7ff5484c024f
AgrestiInterval <- function(x, n, conf.level = 0.95){
p <- (x+2)/(n+4)
sd <- sqrt(p*((1-p)/(n+4)))
z <- qnorm(c( (1 - conf.level)/2, 1- (1-conf.level)/2)) #returns the value of thresholds at which conf.level has to be cut at. for 95% CI, this is -1.96 and +1.96
ci <- p + z*sd
return(ci)
}
wkdy_prop_table <- all_ves_wkdy |>
group_by(network, npz_id, Site_ID, Dep) |>
mutate(tot_wkday_prop = Total_ves_dep/sum(Total_ves_dep),
ag_int_tot = AgrestiInterval(x = tot_wkday_prop, n = sum(Total_ves_dep)))
wkdy_prop_table <- all_ves_wkdy |>
group_by(network, npz_id, Site_ID, Dep) |>
mutate(tot_wkday_prop = Total_ves_dep/sum(Total_ves_dep),
ag_int_tot_low = AgrestiInterval(x = tot_wkday_prop, n = sum(Total_ves_dep))[1])
AgrestiInterval(x = 15, n = 200)
15/200
AgrestiInterval(x = 2, n = 200)
2/200
wkdy_prop_table <- all_ves_wkdy |>
group_by(network, npz_id, Site_ID, Dep) |>
mutate(tot_wkday_prop = Total_ves_dep/sum(Total_ves_dep),
ag_int_tot_low = AgrestiInterval(x = Total_ves_dep, n = sum(Total_ves_dep)))
wkdy_prop_table <- all_ves_wkdy |>
group_by(network, npz_id, Site_ID, Dep) |>
mutate(tot_wkday_prop = Total_ves_dep/sum(Total_ves_dep))
wkdy_prop_table <- all_ves_wkdy |>
group_by(network, npz_id, Site_ID, Dep) |>
mutate(Inside_transit = Total_inside - Inside_maneuver,
Inside_transit_small = Total_inside_small - Inside_maneuver_small,
tot_prop = Total_ves_dep/sum(Total_ves_dep),
ins_prop = Total_inside/sum(Total_inside),
small_prop = Total_inside_small/sum(Total_inside_small),
ins_trans_prop = Inside_transit/sum(Inside_transit),
small_trans_prop = Inside_transit_small/sum(Inside_transit_small),
ins_man_prop = Inside_maneuver/sum(Inside_maneuver),
small_man_prop = Inside_maneuver_small/sum(Inside_maneuver_small))
wkdy_prop_long <- wkdy_prop_table |>
pivot_longer(cols = -c(network, npz_id, Site_ID, Dep, Weekday), values_to = "Weekday_prop", names_to = "Ves_behav")
View(wkdy_prop_long)
wkdy_prop_long <- wkdy_prop_table |>
pivot_longer(cols = -c(network, npz_id, Site_ID, Dep, Weekday),
values_to = "Weekday_prop", names_to = "Ves_behav") |>
filter(grep("prop",.))
?grepl
wkdy_prop_long <- wkdy_prop_table |>
pivot_longer(cols = -c(network, npz_id, Site_ID, Dep, Weekday),
values_to = "Weekday_prop", names_to = "Ves_behav") |>
filter(grepl("prop"))
wkdy_prop_long <- wkdy_prop_table |>
pivot_longer(cols = -c(network, npz_id, Site_ID, Dep, Weekday),
values_to = "Weekday_prop", names_to = "Ves_behav") |>
filter(grepl(x = ., "prop"))
wkdy_prop_long <- wkdy_prop_table |>
pivot_longer(cols = -c(network, npz_id, Site_ID, Dep, Weekday),
values_to = "Weekday_prop", names_to = "Ves_behav") |>
filter(., pattern = "prop")
wkdy_prop_long <- wkdy_prop_table |>
pivot_longer(cols = -c(network, npz_id, Site_ID, Dep, Weekday),
values_to = "Weekday_prop", names_to = "Ves_behav") |>
filter(grepl("prop", Ves_behav))
View(wkdy_prop_long)
levels(all_ves_by_weekday$Weekday) <- c("M","T","W","R","F","Sa","Su"))
all_ves_wkdy <- all_sites_hp |>
group_by(network, npz_id, Site_ID, Dep, Weekday)|>
# get daily vessel counts: total, inside, inside_small, maneuver, maneuver_small
summarise(Total_ves_dep = sum(Total_Vessels, na.rm = TRUE),
Total_inside = sum(total_inside, na.rm = TRUE),
Total_inside_small = sum(total_inside_small, na.rm = TRUE),
Inside_maneuver = sum(man_inside, na.rm = TRUE),
Inside_maneuver_small = sum(man_inside_small, na.rm = TRUE)) |>
mutate(Inside_transit = Total_inside - Inside_maneuver,
Inside_transit_small = Total_inside_small - Inside_maneuver_small,
Weekday = factor(Weekday, levels=c("Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday")),
network = case_when(Site_ID == "CG" | Site_ID == "EP" | Site_ID == "WP" ~ "Temperate East",
Site_ID == "DNE" | Site_ID == "DSW" | Site_ID == "NGN"| Site_ID == "NGS" ~ "Northwest", TRUE ~ "South-west"
),
network = factor(network, levels = c("Temperate East","Northwest","South-west"))) |>
filter(Total_ves_dep > 0)
levels(all_ves_wkdy$Weekday) <- c("M","T","W","R","F","Sa","Su"))
levels(all_ves_wkdy$Weekday) <- c("M","T","W","R","F","Sa","Su")
# function to calculate Agresti-Coull interval
# from https://towardsdatascience.com/five-confidence-intervals-for-proportions-that-you-should-know-about-7ff5484c024f
AgrestiInterval <- function(x, n, conf.level = 0.95){
p <- (x+2)/(n+4)
sd <- sqrt(p*((1-p)/(n+4)))
z <- qnorm(c( (1 - conf.level)/2, 1- (1-conf.level)/2)) #returns the value of thresholds at which conf.level has to be cut at. for 95% CI, this is -1.96 and +1.96
ci <- p + z*sd
return(ci)
}
wkdy_prop_table <- all_ves_wkdy |>
group_by(network, npz_id, Site_ID, Dep) |>
mutate(Inside_transit = Total_inside - Inside_maneuver,
Inside_transit_small = Total_inside_small - Inside_maneuver_small,
tot_prop = Total_ves_dep/sum(Total_ves_dep),
ins_prop = Total_inside/sum(Total_inside),
small_prop = Total_inside_small/sum(Total_inside_small),
ins_trans_prop = Inside_transit/sum(Inside_transit),
small_trans_prop = Inside_transit_small/sum(Inside_transit_small),
ins_man_prop = Inside_maneuver/sum(Inside_maneuver),
small_man_prop = Inside_maneuver_small/sum(Inside_maneuver_small))
wkdy_prop_long <- wkdy_prop_table |>
pivot_longer(cols = -c(network, npz_id, Site_ID, Dep, Weekday),
values_to = "Weekday_prop", names_to = "Ves_behav") |>
filter(grepl("prop", Ves_behav))
unique(wkdy_prop_long$Ves_behav)
# relevel categorical values for plotting
mutate(Ves_behav = fct(Ves_behav),
Ves_behav = fct_relevel(Ves_behav, c("tot_prop","small_prop", "ins_prop", "small_trans_prop","small_man_prop", "ins_trans_prop","ins_man_prop")),
network = fct(network),
network = fct_relevel(network, c("Temperate East","Northwest")),
npz_id = fct(npz_id),
npz_id = fct_relevel(npz_id, c("CGMP","SIMP","DMP","NMP")))
wkdy_prop_long <- wkdy_prop_table |>
pivot_longer(cols = -c(network, npz_id, Site_ID, Dep, Weekday),
values_to = "Weekday_prop", names_to = "Ves_behav") |>
filter(grepl("prop", Ves_behav)) |>
# relevel categorical values for plotting
mutate(Ves_behav = fct(Ves_behav),
Ves_behav = fct_relevel(Ves_behav, c("tot_prop","small_prop", "ins_prop", "small_trans_prop","small_man_prop", "ins_trans_prop","ins_man_prop")),
network = fct(network),
network = fct_relevel(network, c("Temperate East","Northwest")),
npz_id = fct(npz_id),
npz_id = fct_relevel(npz_id, c("CGMP","SIMP","DMP","NMP")))
wkdy_prop_long <- wkdy_prop_table |>
pivot_longer(cols = -c(network, npz_id, Site_ID, Dep, Weekday),
values_to = "Weekday_prop", names_to = "Ves_behav") |>
filter(grepl("prop", Ves_behav)) |>
# relevel categorical values for plotting
mutate(Ves_behav = fct(Ves_behav),
Ves_behav = fct_relevel(Ves_behav, c("tot_prop","small_prop", "ins_prop", "small_trans_prop","small_man_prop", "ins_trans_prop","ins_man_prop")),
# network = fct(network),
network = fct_relevel(network, c("Temperate East","Northwest")),
npz_id = fct(npz_id),
npz_id = fct_relevel(npz_id, c("CGMP","SIMP","DMP","NMP")))
View(wkdy_prop_long)
write_csv(all_ves_wkdy,
file = "output/All_ves_by_weekday.csv")
# Total vessel presence
write_csv(all_ves_by_site,
file = "output/All_ves_by_dep.csv")
write_csv(all_ves_by_npz,
file = "output/All_ves_by_npz.csv")
write_csv(all_ves_wkdy,
file = "output/All_ves_by_weekday.csv")
wkday_prop_total <- wkdy_prop_long |>
filter(Ves_behav == "tot_prop" | Ves_behav == "ins_prop")
ggplot(data = wkday_prop_total,
aes(x = npz_id,
y = Weekday_prop)) |>
geom_col(aes(fill = Ves_behav))
ggplot(data = wkday_prop_total,
aes(x = npz_id,
y = Weekday_prop)) +
geom_col(aes(fill = Ves_behav))
ggplot(data = wkday_prop_total,
aes(x = Weekday,
y = Weekday_prop)) +
geom_col(aes(fill = Ves_behav))
ggplot(data = wkday_prop_total,
aes(x = Weekday,
y = Weekday_prop)) +
geom_col(aes(fill = Ves_behav),
position = position_dodge())
View(wkday_prop_total)
ggplot(data = wkday_prop_total,
aes(x = Weekday,
y = Weekday_prop)) +
geom_col(aes(fill = Ves_behav),
position = position_dodge()) +
facet_grid(rows = npz_id)
ggplot(data = wkday_prop_total,
aes(x = Weekday,
y = Weekday_prop)) +
geom_col(aes(fill = Ves_behav),
position = position_dodge()) +
facet_grid(rows = vars(npz_id))
wkday_prop_total <- wkdy_prop_long |>
filter(Ves_behav == "tot_prop")
ggplot(data = wkday_prop_total,
aes(x = Weekday,
y = Weekday_prop)) +
geom_col(aes(fill = Ves_behav),
position = position_dodge()) +
facet_grid(rows = vars(npz_id))
wkday_prop_total <- wkdy_prop_long |>
filter(Ves_behav == "tot_prop",
npz_id != "MMP")
ggplot(data = wkday_prop_total,
aes(x = Weekday,
y = Weekday_prop)) +
geom_col(aes(fill = Ves_behav),
position = position_dodge()) +
facet_grid(rows = vars(npz_id))
wkday_prop_total <- wkdy_prop_long |>
filter(Ves_behav == "tot_prop")
ggplot(data = wkday_prop_total,
aes(x = Weekday,
y = Weekday_prop)) +
geom_col(aes(fill = Ves_behav),
position = position_dodge()) +
facet_grid(rows = vars(npz_id),
scales = "free_y")
ggplot(data = wkday_prop_total |> filter (npz_id != "MMP"),
aes(x = Weekday,
y = Weekday_prop)) +
geom_col(aes(fill = Ves_behav),
position = position_dodge()) +
facet_grid(rows = vars(npz_id),
scales = "free_y")
ggplot(data = wkday_prop_total |> filter (npz_id != "MMP"),
aes(x = Weekday,
y = Weekday_prop)) +
geom_col(aes(fill = Ves_behav),
position = position_dodge(),
show.legend = FALSE) +
labs(y = "Proportion",
x = "Weekday")
ggplot(data = wkday_prop_total |> filter (npz_id != "MMP"),
aes(x = Weekday,
y = Weekday_prop)) +
geom_col(aes(fill = Ves_behav),
position = position_dodge(),
show.legend = FALSE) +
labs(y = "Proportion",
x = "Weekday")+
facet_grid(rows = vars(npz_id),
scales = "free_y")
ggplot(data = wkday_prop_total |> filter (npz_id != "MMP"),
aes(x = Weekday,
y = Weekday_prop)) +
geom_col(aes(fill = Ves_behav),
position = position_dodge(),
show.legend = FALSE) +
labs(y = "Proportion",
x = "Weekday")
ggplot(data = wkday_prop_total |> filter (npz_id != "MMP"),
aes(x = Weekday,
y = Weekday_prop)) +
geom_col(aes(fill = Ves_behav),
position = position_dodge(),
show.legend = FALSE) +
labs(y = "Proportion",
x = "Weekday")+
facet_grid(rows = vars(Dep),
scales = "free_y")
ggplot(data = wkday_prop_total |> filter (npz_id != "MMP"),
aes(x = Weekday,
y = Weekday_prop)) +
geom_col(aes(fill = Ves_behav),
position = position_dodge(),
show.legend = FALSE) +
labs(y = "Proportion",
x = "Weekday")+
facet_grid(rows = vars(network),
scales = "free_y")
ggplot(data = wkday_prop_total |> filter (npz_id != "MMP"),
aes(x = Weekday,
y = Weekday_prop)) +
geom_col(aes(fill = Ves_behav),
position = position_dodge(),
show.legend = FALSE) +
labs(y = "Proportion",
x = "Weekday")+
facet_grid(rows = vars(network))
ggplot(data = wkday_prop_total |> filter (npz_id != "MMP"),
aes(x = Weekday,
y = Weekday_prop)) +
geom_col(aes(fill = Ves_behav),
position = position_dodge(),
show.legend = FALSE) +
labs(y = "Proportion",
x = "Weekday")+
facet_grid(rows = vars(npz_id))
ggplot(data = wkday_prop_total |> filter (npz_id != "MMP"),
aes(x = Weekday,
y = Weekday_prop)) +
geom_col(aes(fill = network),
position = position_dodge(),
show.legend = FALSE) +
labs(y = "Proportion",
x = "Weekday")+
facet_grid(rows = vars(npz_id))
ggplot(data = wkday_prop_total |> filter (npz_id != "MMP"),
aes(x = Weekday,
y = Weekday_prop)) +
geom_col(aes(fill = network),
position = position_dodge()) +
labs(y = "Proportion",
x = "Weekday")+
facet_grid(rows = vars(npz_id))
ggplot(data = wkday_prop_total |> filter (npz_id != "MMP"),
aes(x = Weekday,
y = Weekday_prop)) +
geom_col(aes(fill = network),
position = position_dodge()) +
labs(y = "Proportion",
x = "Weekday",
fill = "Network")+
facet_grid(rows = vars(npz_id))
ggplot(data = wkday_prop_total |> filter (npz_id != "MMP"),
aes(x = Weekday,
y = Weekday_prop)) +
geom_col(aes(fill = network),
position = position_dodge()) +
labs(y = "Proportion",
x = "Weekday",
fill = "Network")+
facet_grid(rows = vars(npz_id)) +
theme(
axis.text.x = element_text(face = "bold"),
strip.text.y = element_text(face = "bold")
)
ggplot(data = wkday_prop_total |> filter (npz_id != "MMP"),
aes(x = Weekday,
y = Weekday_prop)) +
geom_col(aes(fill = network),
position = position_dodge()) +
scale_fill_viridis_d(direction = -1)+
labs(y = "Proportion",
x = "Weekday",
fill = "Network")+
facet_grid(rows = vars(npz_id)) +
theme(
axis.text.x = element_text(face = "bold"),
strip.text.y = element_text(face = "bold")
)
ggplot(data = wkday_prop_total |> filter (npz_id != "MMP"),
aes(x = Weekday,
y = Weekday_prop)) +
geom_col(aes(fill = network),
position = position_dodge()) +
scale_fill_viridis_d()+
labs(y = "Proportion",
x = "Weekday",
fill = "Network")+
facet_grid(rows = vars(npz_id)) +
theme(
axis.text.x = element_text(face = "bold"),
strip.text.y = element_text(face = "bold")
)
ggplot(data = wkday_prop_total |> filter (npz_id != "MMP"),
aes(x = Weekday,
y = Weekday_prop)) +
geom_col(aes(fill = network),
position = position_dodge()) +
scale_fill_viridis_d(end = 0.75)+
labs(y = "Proportion",
x = "Weekday",
fill = "Network")+
facet_grid(rows = vars(npz_id)) +
theme(
axis.text.x = element_text(face = "bold"),
strip.text.y = element_text(face = "bold")
)
ggplot(data = wkday_prop_total |> filter (npz_id != "MMP"),
aes(x = Weekday,
y = Weekday_prop)) +
geom_col(aes(fill = network),
position = position_dodge()) +
scale_fill_viridis_d(end = 0.75, direction = -1)+
labs(y = "Proportion",
x = "Weekday",
fill = "Network")+
facet_grid(rows = vars(npz_id)) +
theme(
axis.text.x = element_text(face = "bold"),
strip.text.y = element_text(face = "bold")
)
ggsave(paste0("figs/", "Weekday_props_npz.png"), width=10, height=6,
units="in", dpi=300)
ggsave(paste0("figs/", "Weekday_props_npz.png"), width=8, height=10,
units="in", dpi=300)
wkday_prop_ins <- wkdy_prop_long |>
filter(Ves_behav == "ins_prop" | Ves_behav == "ins_trans_prop" | Ves_behav == "ins_man_prop")
ggplot(data = wkday_prop_ins |> filter (npz_id != "MMP"),
aes(x = Weekday,
y = Weekday_prop)) +
geom_col(aes(fill = network),
position = position_dodge()) +
scale_fill_viridis_d(end = 0.75, direction = -1)+
labs(y = "Proportion",
x = "Weekday",
fill = "Network")+
facet_grid(rows = vars(npz_id)) +
theme(
axis.text.x = element_text(face = "bold"),
strip.text.y = element_text(face = "bold")
)
ggplot(data = wkday_prop_ins |> filter (npz_id != "MMP" | "npz_id" != "SWCMP"),
aes(x = Weekday,
y = Weekday_prop)) +
geom_col(aes(fill = network),
position = position_dodge()) +
scale_fill_viridis_d(end = 0.75, direction = -1)+
labs(y = "Proportion",
x = "Weekday",
fill = "Network")+
facet_grid(rows = vars(npz_id)) +
theme(
axis.text.x = element_text(face = "bold"),
strip.text.y = element_text(face = "bold")
)
ggplot(data = wkday_prop_ins |> filter (npz_id != "MMP" & "npz_id" != "SWCMP"),
aes(x = Weekday,
y = Weekday_prop)) +
geom_col(aes(fill = network),
position = position_dodge()) +
scale_fill_viridis_d(end = 0.75, direction = -1)+
labs(y = "Proportion",
x = "Weekday",
fill = "Network")+
facet_grid(rows = vars(npz_id)) +
theme(
axis.text.x = element_text(face = "bold"),
strip.text.y = element_text(face = "bold")
)
ggplot(data = wkday_prop_ins |> filter (npz_id != "MMP" & npz_id != "SWCMP"),
aes(x = Weekday,
y = Weekday_prop)) +
geom_col(aes(fill = network),
position = position_dodge()) +
scale_fill_viridis_d(end = 0.75, direction = -1)+
labs(y = "Proportion",
x = "Weekday",
fill = "Network")+
facet_grid(rows = vars(npz_id)) +
theme(
axis.text.x = element_text(face = "bold"),
strip.text.y = element_text(face = "bold")
)
ggplot(data = wkday_prop_ins |> filter (npz_id != "MMP" & npz_id != "SWCMP"),
aes(x = Weekday,
y = Weekday_prop)) +
geom_col(aes(fill = Ves_behav),
position = position_dodge()) +
scale_fill_viridis_d(end = 0.75, direction = -1)+
labs(y = "Proportion",
x = "Weekday",
fill = "Network")+
facet_grid(rows = vars(npz_id)) +
theme(
axis.text.x = element_text(face = "bold"),
strip.text.y = element_text(face = "bold")
)
ggplot(data = wkday_prop_ins |> filter (npz_id != "MMP" & npz_id != "SWCMP"),
aes(x = Weekday,
y = Weekday_prop)) +
geom_col(aes(fill = Ves_behav),
position = position_dodge()) +
scale_fill_viridis_d(end = 0.75, direction = -1)+
labs(y = "Proportion",
x = "Weekday",
fill = "Network")+
facet_grid(rows = vars(npz_id),
cols = Ves_behav) +
theme(
axis.text.x = element_text(face = "bold"),
strip.text.y = element_text(face = "bold")
)
ggplot(data = wkday_prop_ins |> filter (npz_id != "MMP" & npz_id != "SWCMP"),
aes(x = Weekday,
y = Weekday_prop)) +
geom_col(aes(fill = Ves_behav),
position = position_dodge()) +
scale_fill_viridis_d(end = 0.75, direction = -1)+
labs(y = "Proportion",
x = "Weekday",
fill = "Network")+
facet_grid(rows = vars(npz_id),
cols = vars(Ves_behav)) +
theme(
axis.text.x = element_text(face = "bold"),
strip.text.y = element_text(face = "bold")
)
ggsave(paste0("figs/", "Weekday_props_npz_inside.png"), width=8, height=10, units="in", dpi=300)
View(wkday_prop_ins)
