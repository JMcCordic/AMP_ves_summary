Ves_behav == "Total_inside_small",
npz_id != "SWCMP"),
aes(x = Dep_ID,
y = ves_counts_diverge,
fill = Ves_behav)) +
geom_col(position = position_stack(reverse = TRUE)) +
coord_flip()+
scale_y_continuous(limits = c(-400, 400),
breaks = breakvals_small,
labels = abs(breakvals_small))+
scale_fill_viridis_d(direction = -1)+
labs(x = "NPZ",
y = "N vessels",
fill = "Inside vs. Outside",
title = "Inside-Outside Counts (Small Vessels)") +
facet_grid(rows = vars(npz_id),
scales = "free",
space = "free",
drop = TRUE)+
theme(
# axis.text.x = element_text(angle = 90),
strip.text.y = element_text(face = "bold")
)
View(all_ves_long)
ggplot(data = all_ves_long |>
filter(Ves_behav == "total_out_small" |
Ves_behav == "Total_inside_small",
npz_id != "SWCMP"),
aes(x = Dep_ID,
y = ves_counts_diverge,
fill = Ves_behav)) +
geom_col(position = position_stack(reverse = TRUE)) +
coord_flip()+
scale_y_continuous(limits = c(-400, 400),
breaks = breakvals_small,
labels = abs(breakvals_small))+
scale_fill_viridis_d(direction = -1)+
labs(x = "NPZ",
y = "N vessels",
fill = "Inside vs. Outside",
title = "Inside-Outside Counts (Small Vessels)") +
facet_grid(rows = vars(npz_id),
scales = "free_x",
space = "free",
drop = TRUE)+
theme(
# axis.text.x = element_text(angle = 90),
strip.text.y = element_text(face = "bold")
)
ggplot(data = all_ves_long |>
filter(Ves_behav == "total_out_small" |
Ves_behav == "Total_inside_small",
npz_id != "SWCMP"),
aes(x = Dep,
y = ves_counts_diverge,
fill = Ves_behav)) +
geom_col(position = position_stack(reverse = TRUE)) +
coord_flip()+
scale_y_continuous(limits = c(-400, 400),
breaks = breakvals_small,
labels = abs(breakvals_small))+
scale_fill_viridis_d(direction = -1)+
labs(x = "NPZ",
y = "N vessels",
fill = "Inside vs. Outside",
title = "Inside-Outside Counts (Small Vessels)") +
facet_grid(rows = vars(npz_id),
scales = "free_x",
space = "free",
drop = TRUE)+
theme(
# axis.text.x = element_text(angle = 90),
strip.text.y = element_text(face = "bold")
)
ggplot(data = all_ves_long |>
filter(Ves_behav == "total_out_small" |
Ves_behav == "Total_inside_small",
npz_id != "SWCMP"),
aes(x = npz_id,
y = ves_counts_diverge,
fill = Ves_behav)) +
geom_col(position = position_stack(reverse = TRUE)) +
coord_flip()+
scale_y_continuous(limits = c(-400, 400),
breaks = breakvals_small,
labels = abs(breakvals_small))+
scale_fill_viridis_d(direction = -1)+
labs(x = "NPZ",
y = "N vessels",
fill = "Inside vs. Outside",
title = "Inside-Outside Counts (Small Vessels)") +
facet_grid(rows = vars(npz_id),
scales = "free_x",
space = "free",
drop = TRUE)+
theme(
# axis.text.x = element_text(angle = 90),
strip.text.y = element_text(face = "bold")
)
ggplot(data = all_ves_long |>
filter(Ves_behav == "total_out_small" |
Ves_behav == "Total_inside_small",
npz_id != "SWCMP"),
aes(x = Dep,
y = ves_counts_diverge,
fill = Ves_behav)) +
geom_col(position = position_stack(reverse = TRUE)) +
coord_flip()+
scale_y_continuous(limits = c(-400, 400),
breaks = breakvals_small,
labels = abs(breakvals_small))+
scale_fill_viridis_d(direction = -1)+
labs(x = "NPZ",
y = "N vessels",
fill = "Inside vs. Outside",
title = "Inside-Outside Counts (Small Vessels)") +
facet_grid(rows = vars(npz_id),
scales = "free",
space = "free",
drop = TRUE)+
theme(
# axis.text.x = element_text(angle = 90),
strip.text.y = element_text(face = "bold")
)
ggplot(data = all_ves_long |>
filter(Ves_behav == "total_out_small" |
Ves_behav == "Total_inside_small",
npz_id != "SWCMP"),
aes(x = npz_id,
y = ves_counts_diverge,
fill = Ves_behav)) +
geom_col(position = position_stack(reverse = TRUE)) +
coord_flip()+
scale_y_continuous(limits = c(-400, 400),
breaks = breakvals_small,
labels = abs(breakvals_small))+
scale_fill_viridis_d(direction = -1)+
labs(x = "NPZ",
y = "N vessels",
fill = "Inside vs. Outside",
title = "Inside-Outside Counts (Small Vessels)") +
facet_grid(rows = vars(network),
scales = "free",
space = "free",
drop = TRUE)+
theme(
# axis.text.x = element_text(angle = 90),
strip.text.y = element_text(face = "bold")
)
breakvals_small <- seq(-600, 600, 50)
ggplot(data = all_ves_long |>
filter(Ves_behav == "total_out_small" |
Ves_behav == "Total_inside_small",
npz_id != "SWCMP"),
aes(x = npz_id,
y = ves_counts_diverge,
fill = Ves_behav)) +
geom_col(position = position_stack(reverse = TRUE)) +
coord_flip()+
scale_y_continuous(limits = c(-400, 400),
breaks = breakvals_small,
labels = abs(breakvals_small))+
scale_fill_viridis_d(direction = -1)+
labs(x = "NPZ",
y = "N vessels",
fill = "Inside vs. Outside",
title = "Inside-Outside Counts (Small Vessels)") +
facet_grid(rows = vars(network),
scales = "free",
space = "free",
drop = TRUE)+
theme(
# axis.text.x = element_text(angle = 90),
strip.text.y = element_text(face = "bold")
)
ggplot(data = all_ves_long |>
filter(Ves_behav == "total_out_small" |
Ves_behav == "Total_inside_small",
npz_id != "SWCMP"),
aes(x = npz_id,
y = ves_counts_diverge,
fill = Ves_behav)) +
geom_col(position = position_stack(reverse = TRUE)) +
coord_flip()+
scale_y_continuous(limits = c(-600, 600),
breaks = breakvals_small,
labels = abs(breakvals_small))+
scale_fill_viridis_d(direction = -1)+
labs(x = "NPZ",
y = "N vessels",
fill = "Inside vs. Outside",
title = "Inside-Outside Counts (Small Vessels)") +
facet_grid(rows = vars(network),
scales = "free",
space = "free",
drop = TRUE)+
theme(
# axis.text.x = element_text(angle = 90),
strip.text.y = element_text(face = "bold")
)
breakvals <- seq(-400, 800, 50)
ggplot(data = all_ves_long |>
filter(Ves_behav == "total_outside" |
Ves_behav == "Total_inside",
npz_id != "SWCMP"),
aes(x = Dep,
y = ves_counts_diverge,
fill = Ves_behav)) +
geom_col(position = position_stack(reverse = TRUE)) +
coord_flip()+
scale_y_continuous(limits = c(-400, 400),
breaks = breakvals,
labels = abs(breakvals))+
scale_fill_viridis_d(direction = -1)+
labs(x = "NPZ",
y = "N vessels",
fill = "Inside vs. Outside",
title = "Inside-Outside Totals") +
facet_grid(vars(npz_id),
scales = "free",
space = "free",
drop = TRUE)+
theme(
# axis.text.x = element_text(angle = 90),
strip.text.y = element_text(face = "bold")
)
ggplot(data = all_ves_long |>
filter(Ves_behav == "total_outside" |
Ves_behav == "Total_inside",
npz_id != "SWCMP"),
aes(x = npz_id,
y = ves_counts_diverge,
fill = Ves_behav)) +
geom_col(position = position_stack(reverse = TRUE)) +
coord_flip()+
scale_y_continuous(limits = c(-400, 400),
breaks = breakvals,
labels = abs(breakvals))+
scale_fill_viridis_d(direction = -1)+
labs(x = "NPZ",
y = "N vessels",
fill = "Inside vs. Outside",
title = "Inside-Outside Totals") +
facet_grid(vars(network),
scales = "free",
space = "free",
drop = TRUE)+
theme(
# axis.text.x = element_text(angle = 90),
strip.text.y = element_text(face = "bold")
)
ggplot(data = all_ves_long |>
filter(Ves_behav == "total_outside" |
Ves_behav == "Total_inside",
npz_id != "SWCMP"),
aes(x = npz_id,
y = ves_counts_diverge,
fill = Ves_behav)) +
geom_col(position = position_stack(reverse = TRUE)) +
coord_flip()+
scale_y_continuous(limits = c(-400, 800),
breaks = breakvals,
labels = abs(breakvals))+
scale_fill_viridis_d(direction = -1)+
labs(x = "NPZ",
y = "N vessels",
fill = "Inside vs. Outside",
title = "Inside-Outside Totals") +
facet_grid(vars(network),
scales = "free",
space = "free",
drop = TRUE)+
theme(
# axis.text.x = element_text(angle = 90),
strip.text.y = element_text(face = "bold")
)
ggplot(data = all_ves_long |>
filter(Ves_behav == "total_outside" |
Ves_behav == "Total_inside",
npz_id != "SWCMP"),
aes(x = npz_id,
y = ves_counts_diverge,
fill = Ves_behav)) +
geom_col(position = position_stack(reverse = TRUE)) +
coord_flip()+
scale_y_continuous(limits = c(-200, 800),
breaks = breakvals,
labels = abs(breakvals))+
scale_fill_viridis_d(direction = -1)+
labs(x = "NPZ",
y = "N vessels",
fill = "Inside vs. Outside",
title = "Inside-Outside Totals") +
facet_grid(vars(network),
scales = "free",
space = "free",
drop = TRUE)+
theme(
# axis.text.x = element_text(angle = 90),
strip.text.y = element_text(face = "bold")
)
ggsave(paste0("figs/", "Ins_out_counts_npz.png"), width=10, height=8,
units="in", dpi=300)
breakvals_small <- seq(-600, 600, 50)
ggplot(data = all_ves_long |>
filter(Ves_behav == "total_out_small" |
Ves_behav == "Total_inside_small",
npz_id != "SWCMP"),
aes(x = npz_id,
y = ves_counts_diverge,
fill = Ves_behav)) +
geom_col(position = position_stack(reverse = TRUE)) +
coord_flip()+
scale_y_continuous(limits = c(-600, 600),
breaks = breakvals_small,
labels = abs(breakvals_small))+
scale_fill_viridis_d(direction = -1)+
labs(x = "NPZ",
y = "N vessels",
fill = "Inside vs. Outside",
title = "Inside-Outside Counts (Small Vessels)") +
facet_grid(rows = vars(network),
scales = "free",
space = "free",
drop = TRUE)+
theme(
# axis.text.x = element_text(angle = 90),
strip.text.y = element_text(face = "bold")
)
ggsave(paste0("figs/", "Ins_out_counts_small_npz.png"), width=10, height=8,
units="in", dpi=300)
# start by getting hourly counts
all_ves_diel <- all_sites_hp |>
group_by(network, npz_id, Site_ID, Dep, Begin_Date_loc, Begin_Hour_loc)|>
# get daily vessel counts per weekday: total, inside, inside_small, maneuver, maneuver_small
summarise(Total_ves_dep = sum(Total_Vessels, na.rm = TRUE),
Total_inside = sum(total_inside, na.rm = TRUE),
Total_inside_small = sum(total_inside_small, na.rm = TRUE),
Inside_maneuver = sum(man_inside, na.rm = TRUE),
Inside_maneuver_small = sum(man_inside_small, na.rm = TRUE)) |>
mutate(Inside_transit = Total_inside - Inside_maneuver,
Inside_transit_small = Total_inside_small - Inside_maneuver_small,
# Weekday = factor(Weekday, levels=c("Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday")),
network = case_when(Site_ID == "CG" | Site_ID == "EP" | Site_ID == "WP" ~ "Temperate East",
Site_ID == "DNE" | Site_ID == "DSW" | Site_ID == "NGN"| Site_ID == "NGS" ~ "Northwest", TRUE ~ "South-west"
),
network = factor(network, levels = c("Temperate East","Northwest","South-west")))
levels(all_ves_wkdy$Weekday) <- c("M","T","W","R","F","Sa","Su")
# summarize daily totals to get mean-adjusted counts per weekday
daily_means <- all_ves_diel |>
group_by(network, npz_id, Site_ID, Dep, Begin_Date_loc) |>
summarize(n_hrs = n(),
mean_tot = mean(Total_ves_dep, na.rm = TRUE),
mean_ins = mean(Total_inside, na.rm = TRUE),
mean_ins_sm = mean(Total_inside_small, na.rm = TRUE),
mean_trans = mean(Inside_transit, na.rm = TRUE),
mean_trans_sm = mean(Inside_transit_small, na.rm = TRUE),
mean_man = mean(Inside_maneuver, na.rm = TRUE),
mean_man_sm = mean(Inside_maneuver_small, na.rm = TRUE))
diel_mean_adj <- all_ves_diel |>
left_join(daily_means, by = c("Begin_Date_loc", "Dep"), keep = FALSE) |>
group_by(network.x, npz_id.x, Site_ID.x, Dep, Begin_Hour_loc) |>
filter(n_hrs == 24) |>
mutate(tot_diel_adj = Total_ves_dep - mean_tot) |>
summarise(mean_diel = mean(tot_diel_adj, na.rm = TRUE)) |>
mutate(sd_lower = mean_diel - 0.5*(sd(mean_diel)),
sd_upper = mean_diel + 0.5*(sd(mean_diel)))
diel_mean_npz <- all_ves_diel |>
left_join(daily_means, by = c("Begin_Date_loc", "Dep"), keep = FALSE) |>
group_by(network.x, npz_id.x, Begin_Hour_loc) |>
mutate(tot_diel_adj = Total_ves_dep - mean_tot) |>
summarise(mean_diel = mean(tot_diel_adj, na.rm = TRUE)) |>
mutate(sd_lower = mean_diel - 0.5*(sd(mean_diel)),
sd_upper = mean_diel + 0.5*(sd(mean_diel)))
ggplot(data = diel_mean_npz,
aes(x = factor(Begin_Hour_loc),
y = mean_diel)) +
geom_hline(yintercept = 0, colour = "grey50") +
geom_pointrange(aes(ymin = sd_lower,
ymax = sd_upper,
group = npz_id.x,
color = ifelse(mean_diel < 0, 'firebrick','blue')),
size = 0.25,
show.legend = FALSE) +
scale_color_viridis_d(begin = 0.3, end = 0.7,
option = "H",
direction = -1)+
labs(y = "Mean-adjusted average N vessels / hour",
x = "Hour of Day (Local TZ)")+
facet_grid(rows = vars(npz_id.x)) +
theme(
axis.text.x = element_text(face = "bold"),
strip.text.y = element_text(face = "bold")
)
ggsave(paste0("figs/", "Diel_mean_adj_npz.png"), width=8, height=10, units="in", dpi=300)
write_csv(diel_mean_adj,
file = "output/All_ves_diel_mean_adj.csv")
View(diel_mean_npz)
View(all_ves_diel)
diel_mean_adj <- all_ves_diel |>
left_join(daily_means, by = c("Begin_Date_loc", "Dep"), keep = FALSE) |>
group_by(network.x, npz_id.x, Site_ID.x, Dep, Begin_Hour_loc) |>
filter(n_hrs == 24) |>
mutate(tot_diel_adj = Total_ves_dep - mean_tot,
ins_diel_adj = Total_inside - mean_ins,
ins_sm_adj = Total_inside_small - mean_ins_sm) |>
summarise(mean_diel = mean(tot_diel_adj, na.rm = TRUE),
mean_diel_ins = mean(ins_diel_adj, na.rm = TRUE),
mean_diel_ins_sm = mean(ins_sm_adj, na.rm = TRUE)) |>
mutate(sd_lower = mean_diel - 0.5*(sd(mean_diel)),
sd_upper = mean_diel + 0.5*(sd(mean_diel)),
sd_lower_ins = mean_diel_ins - 0.5*(sd(mean_diel_ins)),
sd_upper_ins = mean_diel_ins + 0.5*(sd(mean_diel_ins)),
sd_lower_ins_sm = mean_diel_ins - 0.5*(sd(mean_diel_ins)),
sd_upper_ins_sm = mean_diel_ins_sm + 0.5*(sd(mean_diel_ins_sm)))
diel_mean_npz <- all_ves_diel |>
left_join(daily_means, by = c("Begin_Date_loc", "Dep"), keep = FALSE) |>
group_by(network.x, npz_id.x, Begin_Hour_loc) |>
mutate(tot_diel_adj = Total_ves_dep - mean_tot,
ins_diel_adj = Total_inside - mean_ins,
ins_sm_adj = Total_inside_small - mean_ins_sm) |>
summarise(mean_diel = mean(tot_diel_adj, na.rm = TRUE),
mean_diel_ins = mean(ins_diel_adj, na.rm = TRUE),
mean_diel_ins_sm = mean(ins_sm_adj, na.rm = TRUE)) |>
mutate(sd_lower = mean_diel - 0.5*(sd(mean_diel)),
sd_upper = mean_diel + 0.5*(sd(mean_diel)),
sd_lower_ins = mean_diel_ins - 0.5*(sd(mean_diel_ins)),
sd_upper_ins = mean_diel_ins + 0.5*(sd(mean_diel_ins)),
sd_lower_ins_sm = mean_diel_ins - 0.5*(sd(mean_diel_ins)),
sd_upper_ins_sm = mean_diel_ins_sm + 0.5*(sd(mean_diel_ins_sm)))
ggplot(data = diel_mean_npz,
aes(x = factor(Begin_Hour_loc),
y = mean_diel)) +
geom_hline(yintercept = 0, colour = "grey50") +
geom_pointrange(aes(ymin = sd_lower,
ymax = sd_upper,
group = npz_id.x,
color = ifelse(mean_diel < 0, 'firebrick','blue')),
size = 0.25,
show.legend = FALSE) +
scale_color_viridis_d(begin = 0.3, end = 0.7,
option = "H",
direction = -1)+
labs(y = "Mean-adjusted average N vessels / hour",
x = "Hour of Day (Local TZ)")+
facet_grid(rows = vars(npz_id.x)) +
theme(
axis.text.x = element_text(face = "bold"),
strip.text.y = element_text(face = "bold")
)
ggplot(data = diel_mean_npz,
aes(x = factor(Begin_Hour_loc),
y = mean_diel_ins_sm)) +
geom_hline(yintercept = 0, colour = "grey50") +
geom_pointrange(aes(ymin = sd_lower_ins_sm,
ymax = sd_upper_ins_sm,
group = npz_id.x,
color = ifelse(mean_diel_ins_sm < 0, 'firebrick','blue')),
size = 0.25,
show.legend = FALSE) +
scale_color_viridis_d(begin = 0.3, end = 0.7,
option = "H",
direction = -1)+
labs(y = "Mean-adjusted average N vessels / hour",
x = "Hour of Day (Local TZ)")+
facet_grid(rows = vars(npz_id.x)) +
theme(
axis.text.x = element_text(face = "bold"),
strip.text.y = element_text(face = "bold")
)
ggplot(data = diel_mean_npz |> filter(npz_id != "SWCMP"),
aes(x = factor(Begin_Hour_loc),
y = mean_diel_ins_sm)) +
geom_hline(yintercept = 0, colour = "grey50") +
geom_pointrange(aes(ymin = sd_lower_ins_sm,
ymax = sd_upper_ins_sm,
group = npz_id.x,
color = ifelse(mean_diel_ins_sm < 0, 'firebrick','blue')),
size = 0.25,
show.legend = FALSE) +
scale_color_viridis_d(begin = 0.3, end = 0.7,
option = "H",
direction = -1)+
labs(y = "Mean-adjusted average N vessels / hour",
x = "Hour of Day (Local TZ)")+
facet_grid(rows = vars(npz_id.x)) +
theme(
axis.text.x = element_text(face = "bold"),
strip.text.y = element_text(face = "bold")
)
ggplot(data = diel_mean_npz |> filter(npz_id.x != "SWCMP"),
aes(x = factor(Begin_Hour_loc),
y = mean_diel_ins_sm)) +
geom_hline(yintercept = 0, colour = "grey50") +
geom_pointrange(aes(ymin = sd_lower_ins_sm,
ymax = sd_upper_ins_sm,
group = npz_id.x,
color = ifelse(mean_diel_ins_sm < 0, 'firebrick','blue')),
size = 0.25,
show.legend = FALSE) +
scale_color_viridis_d(begin = 0.3, end = 0.7,
option = "H",
direction = -1)+
labs(y = "Mean-adjusted average N vessels / hour",
x = "Hour of Day (Local TZ)")+
facet_grid(rows = vars(npz_id.x)) +
theme(
axis.text.x = element_text(face = "bold"),
strip.text.y = element_text(face = "bold")
)
ggsave(paste0("figs/", "Diel_mean_adj_npz_ins_sm.png"), width=8, height=10, units="in", dpi=300)
ggsave(paste0("figs/", "Diel_mean_adj_npz_ins_sm.png"), width=8, height=10, units="in", dpi=300)
