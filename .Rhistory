linetype = 3, # dotted line
colour = "black") +
scale_color_manual(values = c("red","black"))+
labs(y = "Mean-adjusted average N vessels / weekday",
x = "Weekday")+
facet_nested(rows = vars(network.x, npz_id.x), scales = "free_y") +
theme(
axis.text.x = element_text(face = "bold"),
strip.text.y = element_text(face = "bold")
)
ggplot(data = wkdy_mean_adj,
aes(x = Weekday, y = mean_wk)) +
geom_pointrange(aes(ymin = sd_lower,
ymax = sd_upper,
group = npz_id.x,
color = ifelse(sd_lower <= 0, 'firebrick','blue')),
size = 0.25,
show.legend = FALSE) +
geom_hline(yintercept = 0,
linetype = 3, # dotted line
colour = "black") +
scale_color_manual(values = c("red","black"))+
labs(y = "Mean-adjusted average N vessels / weekday",
x = "Weekday")+
facet_nested(rows = vars(network.x, npz_id.x), nest_line = element_line(),
scales = "free_y") +
theme(
axis.text.x = element_text(face = "bold"),
strip.text.y = element_text(face = "bold")
)
ggplot(data = wkdy_mean_adj,
aes(x = Weekday, y = mean_wk)) +
geom_pointrange(aes(ymin = sd_lower,
ymax = sd_upper,
group = npz_id.x,
color = ifelse(sd_lower <= 0, 'firebrick','blue')),
size = 0.25,
show.legend = FALSE) +
geom_hline(yintercept = 0,
linetype = 3, # dotted line
colour = "black") +
scale_color_manual(values = c("red","black"))+
labs(y = "Mean-adjusted average N vessels / weekday",
x = "Weekday")+
facet_nested(rows = vars(network.x, npz_id.x),
nest_line = element_line(),
scales = "free_y") +
theme(
axis.text.x = element_text(face = "bold"),
strip.background = element_blank(),
strip.text.y = element_text(face = "bold")
)
ggsave(paste0("figs/", "Weekday_mean_adj_npz_presentonly.png"), width=8, height=10, units="in", dpi=300)
# start by getting hourly counts
all_ves_diel <- all_sites_hp |>
group_by(network, npz_id, Site_ID, Dep, Begin_Date_loc, Begin_Hour_loc)|>
# get daily vessel counts per weekday: total, inside, inside_small, maneuver, maneuver_small
summarise(Total_ves_dep = sum(Total_Vessels, na.rm = TRUE),
Total_inside = sum(total_inside, na.rm = TRUE),
Total_inside_small = sum(total_inside_small, na.rm = TRUE),
Inside_maneuver = sum(man_inside, na.rm = TRUE),
Inside_maneuver_small = sum(man_inside_small, na.rm = TRUE)) |>
mutate(Inside_transit = Total_inside - Inside_maneuver,
Inside_transit_small = Total_inside_small - Inside_maneuver_small,
# Weekday = factor(Weekday, levels=c("Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday")),
network = case_when(Site_ID == "CG" | Site_ID == "EP" | Site_ID == "WP" ~ "Temperate East",
Site_ID == "DNE" | Site_ID == "DSW" | Site_ID == "NGN"| Site_ID == "NGS" ~ "Northwest", TRUE ~ "South-west"
),
network = factor(network, levels = c("Temperate East","Northwest","South-west")))
# summarize daily totals to get mean-adjusted counts per weekday
daily_means <- all_ves_diel |>
group_by(network, npz_id, Site_ID, Dep, Begin_Date_loc) |>
summarize(n_hrs = n(),
mean_tot = mean(Total_ves_dep, na.rm = TRUE),
mean_ins = mean(Total_inside, na.rm = TRUE),
mean_ins_sm = mean(Total_inside_small, na.rm = TRUE),
mean_trans = mean(Inside_transit, na.rm = TRUE),
mean_trans_sm = mean(Inside_transit_small, na.rm = TRUE),
mean_man = mean(Inside_maneuver, na.rm = TRUE),
mean_man_sm = mean(Inside_maneuver_small, na.rm = TRUE))
diel_mean_adj <- all_ves_diel |>
left_join(daily_means, by = c("Begin_Date_loc", "Dep"), keep = FALSE) |>
group_by(network.x, npz_id.x, Site_ID.x, Dep, Begin_Hour_loc) |>
filter(n_hrs == 24) |>
mutate(tot_diel_adj = Total_ves_dep - mean_tot,
ins_diel_adj = Total_inside - mean_ins,
ins_sm_adj = Total_inside_small - mean_ins_sm) |>
summarise(mean_diel = mean(tot_diel_adj, na.rm = TRUE),
mean_diel_ins = mean(ins_diel_adj, na.rm = TRUE),
mean_diel_ins_sm = mean(ins_sm_adj, na.rm = TRUE)) |>
mutate(sd_lower = mean_diel - 0.5*(sd(mean_diel)),
sd_upper = mean_diel + 0.5*(sd(mean_diel)),
sd_lower_ins = mean_diel_ins - 0.5*(sd(mean_diel_ins)),
sd_upper_ins = mean_diel_ins + 0.5*(sd(mean_diel_ins)),
sd_lower_ins_sm = mean_diel_ins - 0.5*(sd(mean_diel_ins)),
sd_upper_ins_sm = mean_diel_ins_sm + 0.5*(sd(mean_diel_ins_sm)))
diel_mean_npz <- all_ves_diel |>
left_join(daily_means, by = c("Begin_Date_loc", "Dep"), keep = FALSE) |>
group_by(network.x, npz_id.x, Begin_Hour_loc) |>
mutate(tot_diel_adj = Total_ves_dep - mean_tot,
ins_diel_adj = Total_inside - mean_ins,
ins_sm_adj = Total_inside_small - mean_ins_sm) |>
summarise(mean_diel = mean(tot_diel_adj, na.rm = TRUE),
mean_diel_ins = mean(ins_diel_adj, na.rm = TRUE),
mean_diel_ins_sm = mean(ins_sm_adj, na.rm = TRUE)) |>
mutate(sd_lower = mean_diel - 0.5*(sd(mean_diel)),
sd_upper = mean_diel + 0.5*(sd(mean_diel)),
sd_lower_ins = mean_diel_ins - 0.5*(sd(mean_diel_ins)),
sd_upper_ins = mean_diel_ins + 0.5*(sd(mean_diel_ins)),
sd_lower_ins_sm = mean_diel_ins - 0.5*(sd(mean_diel_ins)),
sd_upper_ins_sm = mean_diel_ins_sm + 0.5*(sd(mean_diel_ins_sm)))
ggplot(data = diel_mean_npz,
aes(x = factor(Begin_Hour_loc),
y = mean_diel)) +
geom_hline(yintercept = 0, colour = "grey50") +
geom_pointrange(aes(ymin = sd_lower,
ymax = sd_upper,
group = npz_id.x,
color = ifelse(sd_lower <= 0, 'firebrick','blue')),
size = 0.25,
show.legend = FALSE) +
geom_hline(yintercept = 0,
linetype = 3, # dotted line
colour = "black") +
scale_color_manual(values = c("red","black"))+
labs(y = "Mean-adjusted average N vessels / hour",
x = "Hour of Day (Local TZ)")+
facet_nested(rows = vars(network.x, npz_id.x),
nest_line = element_line(),
scales = "free_y") +
theme(
axis.text.x = element_text(face = "bold"),
strip.background = element_blank(),
strip.text.y = element_text(face = "bold")
)
diel_mean_adj <- all_ves_diel |>
left_join(daily_means, by = c("Begin_Date_loc", "Dep"), keep = FALSE) |>
group_by(network.x, npz_id.x, Site_ID.x, Dep, Begin_Hour_loc) |>
filter(n_hrs == 24, # only keep full days
# only keep days with presence for mean-adjusting
mean_tot > 0) |>
mutate(tot_diel_adj = Total_ves_dep - mean_tot,
ins_diel_adj = Total_inside - mean_ins,
ins_sm_adj = Total_inside_small - mean_ins_sm) |>
summarise(mean_diel = mean(tot_diel_adj, na.rm = TRUE),
mean_diel_ins = mean(ins_diel_adj, na.rm = TRUE),
mean_diel_ins_sm = mean(ins_sm_adj, na.rm = TRUE)) |>
mutate(sd_lower = mean_diel - 0.5*(sd(mean_diel)),
sd_upper = mean_diel + 0.5*(sd(mean_diel)),
sd_lower_ins = mean_diel_ins - 0.5*(sd(mean_diel_ins)),
sd_upper_ins = mean_diel_ins + 0.5*(sd(mean_diel_ins)),
sd_lower_ins_sm = mean_diel_ins - 0.5*(sd(mean_diel_ins)),
sd_upper_ins_sm = mean_diel_ins_sm + 0.5*(sd(mean_diel_ins_sm)))
diel_mean_npz <- all_ves_diel |>
left_join(daily_means, by = c("Begin_Date_loc", "Dep"), keep = FALSE) |>
group_by(network.x, npz_id.x, Begin_Hour_loc) |>
mutate(tot_diel_adj = Total_ves_dep - mean_tot,
ins_diel_adj = Total_inside - mean_ins,
ins_sm_adj = Total_inside_small - mean_ins_sm) |>
summarise(mean_diel = mean(tot_diel_adj, na.rm = TRUE),
mean_diel_ins = mean(ins_diel_adj, na.rm = TRUE),
mean_diel_ins_sm = mean(ins_sm_adj, na.rm = TRUE)) |>
mutate(sd_lower = mean_diel - 0.5*(sd(mean_diel)),
sd_upper = mean_diel + 0.5*(sd(mean_diel)),
sd_lower_ins = mean_diel_ins - 0.5*(sd(mean_diel_ins)),
sd_upper_ins = mean_diel_ins + 0.5*(sd(mean_diel_ins)),
sd_lower_ins_sm = mean_diel_ins - 0.5*(sd(mean_diel_ins)),
sd_upper_ins_sm = mean_diel_ins_sm + 0.5*(sd(mean_diel_ins_sm)))
ggplot(data = diel_mean_npz,
aes(x = factor(Begin_Hour_loc),
y = mean_diel)) +
geom_hline(yintercept = 0, colour = "grey50") +
geom_pointrange(aes(ymin = sd_lower,
ymax = sd_upper,
group = npz_id.x,
color = ifelse(sd_lower <= 0, 'firebrick','blue')),
size = 0.25,
show.legend = FALSE) +
geom_hline(yintercept = 0,
linetype = 3, # dotted line
colour = "black") +
scale_color_manual(values = c("red","black"))+
labs(y = "Mean-adjusted average N vessels / hour",
x = "Hour of Day (Local TZ)")+
facet_nested(rows = vars(network.x, npz_id.x),
nest_line = element_line(),
scales = "free_y") +
theme(
axis.text.x = element_text(face = "bold"),
strip.background = element_blank(),
strip.text.y = element_text(face = "bold")
)
ggsave(paste0("figs/", "Diel_mean_adj_npz_presonly.png"), width=8, height=10, units="in", dpi=300)
diel_mean_adj <- all_ves_diel |>
left_join(daily_means, by = c("Begin_Date_loc", "Dep"), keep = FALSE) |>
group_by(network.x, npz_id.x, Site_ID.x, Dep_ID.x, Begin_Hour_loc) |>
filter(n_hrs == 24, # only keep full days
# only keep days with presence for mean-adjusting
mean_tot > 0) |>
mutate(tot_diel_adj = Total_ves_dep - mean_tot,
ins_diel_adj = Total_inside - mean_ins,
ins_sm_adj = Total_inside_small - mean_ins_sm) |>
summarise(mean_diel = mean(tot_diel_adj, na.rm = TRUE),
mean_diel_ins = mean(ins_diel_adj, na.rm = TRUE),
mean_diel_ins_sm = mean(ins_sm_adj, na.rm = TRUE)) |>
mutate(sd_lower = mean_diel - 0.5*(sd(mean_diel)),
sd_upper = mean_diel + 0.5*(sd(mean_diel)),
sd_lower_ins = mean_diel_ins - 0.5*(sd(mean_diel_ins)),
sd_upper_ins = mean_diel_ins + 0.5*(sd(mean_diel_ins)),
sd_lower_ins_sm = mean_diel_ins - 0.5*(sd(mean_diel_ins)),
sd_upper_ins_sm = mean_diel_ins_sm + 0.5*(sd(mean_diel_ins_sm)))
# start by getting hourly counts
all_ves_diel <- all_sites_hp |>
group_by(network, npz_id, Dep_ID, Begin_Date_loc, Begin_Hour_loc)|>
# get daily vessel counts per weekday: total, inside, inside_small, maneuver, maneuver_small
summarise(Total_ves_dep = sum(Total_Vessels, na.rm = TRUE),
Total_inside = sum(total_inside, na.rm = TRUE),
Total_inside_small = sum(total_inside_small, na.rm = TRUE),
Inside_maneuver = sum(man_inside, na.rm = TRUE),
Inside_maneuver_small = sum(man_inside_small, na.rm = TRUE)) |>
mutate(Inside_transit = Total_inside - Inside_maneuver,
Inside_transit_small = Total_inside_small - Inside_maneuver_small,
# Weekday = factor(Weekday, levels=c("Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday")),
network = case_when(Site_ID == "CG" | Site_ID == "EP" | Site_ID == "WP" ~ "Temperate East",
Site_ID == "DNE" | Site_ID == "DSW" | Site_ID == "NGN"| Site_ID == "NGS" ~ "Northwest", TRUE ~ "South-west"
),
network = factor(network, levels = c("Temperate East","Northwest","South-west")))
# start by getting hourly counts
all_ves_diel <- all_sites_hp |>
group_by(network, npz_id, Dep_ID, Begin_Date_loc, Begin_Hour_loc)|>
# get daily vessel counts per weekday: total, inside, inside_small, maneuver, maneuver_small
summarise(Total_ves_dep = sum(Total_Vessels, na.rm = TRUE),
Total_inside = sum(total_inside, na.rm = TRUE),
Total_inside_small = sum(total_inside_small, na.rm = TRUE),
Inside_maneuver = sum(man_inside, na.rm = TRUE),
Inside_maneuver_small = sum(man_inside_small, na.rm = TRUE)) |>
mutate(Inside_transit = Total_inside - Inside_maneuver,
Inside_transit_small = Total_inside_small - Inside_maneuver_small,
# Weekday = factor(Weekday, levels=c("Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday")),
network = case_when(npz_id == "CGMP" | npz_id == "SIMP" ~ "Temperate East",
npz_id == "DMP" | npz_id == "NMP" ~ "Northwest", TRUE ~ "South-west"
),
network = factor(network, levels = c("Temperate East","Northwest","South-west")))
# summarize daily totals to get mean-adjusted counts per weekday
daily_means <- all_ves_diel |>
group_by(network, npz_id, Dep_ID, Begin_Date_loc) |>
summarize(n_hrs = n(),
mean_tot = mean(Total_ves_dep, na.rm = TRUE),
mean_ins = mean(Total_inside, na.rm = TRUE),
mean_ins_sm = mean(Total_inside_small, na.rm = TRUE),
mean_trans = mean(Inside_transit, na.rm = TRUE),
mean_trans_sm = mean(Inside_transit_small, na.rm = TRUE),
mean_man = mean(Inside_maneuver, na.rm = TRUE),
mean_man_sm = mean(Inside_maneuver_small, na.rm = TRUE))
diel_mean_adj <- all_ves_diel |>
left_join(daily_means, by = c("Begin_Date_loc", "Dep"), keep = FALSE) |>
group_by(network.x, npz_id.x, Dep_ID.x, Begin_Hour_loc) |>
filter(n_hrs == 24, # only keep full days
# only keep days with presence for mean-adjusting
mean_tot > 0) |>
mutate(tot_diel_adj = Total_ves_dep - mean_tot,
ins_diel_adj = Total_inside - mean_ins,
ins_sm_adj = Total_inside_small - mean_ins_sm) |>
summarise(mean_diel = mean(tot_diel_adj, na.rm = TRUE),
mean_diel_ins = mean(ins_diel_adj, na.rm = TRUE),
mean_diel_ins_sm = mean(ins_sm_adj, na.rm = TRUE)) |>
mutate(sd_lower = mean_diel - 0.5*(sd(mean_diel)),
sd_upper = mean_diel + 0.5*(sd(mean_diel)),
sd_lower_ins = mean_diel_ins - 0.5*(sd(mean_diel_ins)),
sd_upper_ins = mean_diel_ins + 0.5*(sd(mean_diel_ins)),
sd_lower_ins_sm = mean_diel_ins - 0.5*(sd(mean_diel_ins)),
sd_upper_ins_sm = mean_diel_ins_sm + 0.5*(sd(mean_diel_ins_sm)))
diel_mean_adj <- all_ves_diel |>
left_join(daily_means, by = c("Begin_Date_loc", "Dep_ID"), keep = FALSE) |>
group_by(network.x, npz_id.x, Dep_ID.x, Begin_Hour_loc) |>
filter(n_hrs == 24, # only keep full days
# only keep days with presence for mean-adjusting
mean_tot > 0) |>
mutate(tot_diel_adj = Total_ves_dep - mean_tot,
ins_diel_adj = Total_inside - mean_ins,
ins_sm_adj = Total_inside_small - mean_ins_sm) |>
summarise(mean_diel = mean(tot_diel_adj, na.rm = TRUE),
mean_diel_ins = mean(ins_diel_adj, na.rm = TRUE),
mean_diel_ins_sm = mean(ins_sm_adj, na.rm = TRUE)) |>
mutate(sd_lower = mean_diel - 0.5*(sd(mean_diel)),
sd_upper = mean_diel + 0.5*(sd(mean_diel)),
sd_lower_ins = mean_diel_ins - 0.5*(sd(mean_diel_ins)),
sd_upper_ins = mean_diel_ins + 0.5*(sd(mean_diel_ins)),
sd_lower_ins_sm = mean_diel_ins - 0.5*(sd(mean_diel_ins)),
sd_upper_ins_sm = mean_diel_ins_sm + 0.5*(sd(mean_diel_ins_sm)))
diel_mean_adj <- all_ves_diel |>
left_join(daily_means, by = c("Begin_Date_loc", "Dep_ID"), keep = FALSE)
diel_mean_adj <- all_ves_diel |>
left_join(daily_means, by = c("Begin_Date_loc", "Dep"), keep = FALSE)
# summarize daily totals to get mean-adjusted counts per weekday
daily_means <- all_ves_diel |>
group_by(network, npz_id, Dep_ID, Dep, Begin_Date_loc) |>
summarize(n_hrs = n(),
mean_tot = mean(Total_ves_dep, na.rm = TRUE),
mean_ins = mean(Total_inside, na.rm = TRUE),
mean_ins_sm = mean(Total_inside_small, na.rm = TRUE),
mean_trans = mean(Inside_transit, na.rm = TRUE),
mean_trans_sm = mean(Inside_transit_small, na.rm = TRUE),
mean_man = mean(Inside_maneuver, na.rm = TRUE),
mean_man_sm = mean(Inside_maneuver_small, na.rm = TRUE))
# start by getting hourly counts
all_ves_diel <- all_sites_hp |>
group_by(network, npz_id, Dep_ID, Dep, Begin_Date_loc, Begin_Hour_loc)|>
# get daily vessel counts per weekday: total, inside, inside_small, maneuver, maneuver_small
summarise(Total_ves_dep = sum(Total_Vessels, na.rm = TRUE),
Total_inside = sum(total_inside, na.rm = TRUE),
Total_inside_small = sum(total_inside_small, na.rm = TRUE),
Inside_maneuver = sum(man_inside, na.rm = TRUE),
Inside_maneuver_small = sum(man_inside_small, na.rm = TRUE)) |>
mutate(Inside_transit = Total_inside - Inside_maneuver,
Inside_transit_small = Total_inside_small - Inside_maneuver_small,
# Weekday = factor(Weekday, levels=c("Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday")),
network = case_when(npz_id == "CGMP" | npz_id == "SIMP" ~ "Temperate East",
npz_id == "DMP" | npz_id == "NMP" ~ "Northwest", TRUE ~ "South-west"
),
network = factor(network, levels = c("Temperate East","Northwest","South-west")))
# summarize daily totals to get mean-adjusted counts per weekday
daily_means <- all_ves_diel |>
group_by(network, npz_id, Dep_ID, Dep, Begin_Date_loc) |>
summarize(n_hrs = n(),
mean_tot = mean(Total_ves_dep, na.rm = TRUE),
mean_ins = mean(Total_inside, na.rm = TRUE),
mean_ins_sm = mean(Total_inside_small, na.rm = TRUE),
mean_trans = mean(Inside_transit, na.rm = TRUE),
mean_trans_sm = mean(Inside_transit_small, na.rm = TRUE),
mean_man = mean(Inside_maneuver, na.rm = TRUE),
mean_man_sm = mean(Inside_maneuver_small, na.rm = TRUE))
diel_mean_adj <- all_ves_diel |>
left_join(daily_means, by = c("Begin_Date_loc", "Dep"), keep = FALSE)
diel_mean_adj <- all_ves_diel |>
left_join(daily_means, by = c("Begin_Date_loc", "Dep"), keep = FALSE) |>
group_by(network.x, npz_id.x, Dep_ID.x, Begin_Hour_loc)
diel_mean_adj <- all_ves_diel |>
left_join(daily_means, by = c("Begin_Date_loc", "Dep"), keep = FALSE) |>
group_by(network.x, npz_id.x, Dep_ID.x, Begin_Hour_loc) |>
filter(n_hrs == 24, # only keep full days
# only keep days with presence for mean-adjusting
mean_tot > 0) |>
mutate(tot_diel_adj = Total_ves_dep - mean_tot,
ins_diel_adj = Total_inside - mean_ins,
ins_sm_adj = Total_inside_small - mean_ins_sm) |>
summarise(mean_diel = mean(tot_diel_adj, na.rm = TRUE),
mean_diel_ins = mean(ins_diel_adj, na.rm = TRUE),
mean_diel_ins_sm = mean(ins_sm_adj, na.rm = TRUE)) |>
mutate(sd_lower = mean_diel - 0.5*(sd(mean_diel)),
sd_upper = mean_diel + 0.5*(sd(mean_diel)),
sd_lower_ins = mean_diel_ins - 0.5*(sd(mean_diel_ins)),
sd_upper_ins = mean_diel_ins + 0.5*(sd(mean_diel_ins)),
sd_lower_ins_sm = mean_diel_ins - 0.5*(sd(mean_diel_ins)),
sd_upper_ins_sm = mean_diel_ins_sm + 0.5*(sd(mean_diel_ins_sm)))
diel_mean_adj_npz <- all_ves_diel |>
left_join(daily_means, by = c("Begin_Date_loc", "Dep"), keep = FALSE) |>
group_by(network.x, npz_id.x, Begin_Hour_loc) |>
mutate(tot_diel_adj = Total_ves_dep - mean_tot,
ins_diel_adj = Total_inside - mean_ins,
ins_sm_adj = Total_inside_small - mean_ins_sm) |>
summarise(mean_diel = mean(tot_diel_adj, na.rm = TRUE),
mean_diel_ins = mean(ins_diel_adj, na.rm = TRUE),
mean_diel_ins_sm = mean(ins_sm_adj, na.rm = TRUE)) |>
mutate(sd_lower = mean_diel - 0.5*(sd(mean_diel)),
sd_upper = mean_diel + 0.5*(sd(mean_diel)),
sd_lower_ins = mean_diel_ins - 0.5*(sd(mean_diel_ins)),
sd_upper_ins = mean_diel_ins + 0.5*(sd(mean_diel_ins)),
sd_lower_ins_sm = mean_diel_ins - 0.5*(sd(mean_diel_ins)),
sd_upper_ins_sm = mean_diel_ins_sm + 0.5*(sd(mean_diel_ins_sm)))
diel_mean_depid <- all_ves_diel |>
left_join(daily_means, by = c("Begin_Date_loc", "Dep"), keep = FALSE) |>
group_by(network.x, npz_id.x, Dep_ID.x, Begin_Hour_loc) |>
filter(n_hrs == 24, # only keep full days
# only keep days with presence for mean-adjusting
mean_tot > 0) |>
mutate(tot_diel_adj = Total_ves_dep - mean_tot,
ins_diel_adj = Total_inside - mean_ins,
ins_sm_adj = Total_inside_small - mean_ins_sm) |>
summarise(mean_diel = mean(tot_diel_adj, na.rm = TRUE),
mean_diel_ins = mean(ins_diel_adj, na.rm = TRUE),
mean_diel_ins_sm = mean(ins_sm_adj, na.rm = TRUE)) |>
mutate(sd_lower = mean_diel - 0.5*(sd(mean_diel)),
sd_upper = mean_diel + 0.5*(sd(mean_diel)),
sd_lower_ins = mean_diel_ins - 0.5*(sd(mean_diel_ins)),
sd_upper_ins = mean_diel_ins + 0.5*(sd(mean_diel_ins)),
sd_lower_ins_sm = mean_diel_ins - 0.5*(sd(mean_diel_ins)),
sd_upper_ins_sm = mean_diel_ins_sm + 0.5*(sd(mean_diel_ins_sm)))
# plot
ggplot(data = diel_mean_depid,
aes(x = factor(Begin_Hour_loc),
y = mean_diel)) +
geom_hline(yintercept = 0, colour = "grey50") +
geom_pointrange(aes(ymin = sd_lower,
ymax = sd_upper,
group = npz_id.x,
color = ifelse(sd_lower <= 0, 'firebrick','blue')),
size = 0.25,
show.legend = FALSE) +
geom_hline(yintercept = 0,
linetype = 3, # dotted line
colour = "black") +
scale_color_manual(values = c("red","black"))+
labs(y = "Mean-adjusted average N vessels / hour",
x = "Hour of Day (Local TZ)")+
facet_nested(rows = vars(network.x, npz_id.x, Dep_ID.x),
nest_line = element_line(),
scales = "free_y") +
theme(
axis.text.x = element_text(face = "bold"),
strip.background = element_blank(),
strip.text.y = element_text(face = "bold")
)
ggsave(paste0("figs/", "Diel_mean_adj_dep_presonly.png"), width=8, height=10, units="in", dpi=300)
# plot
ggplot(data = diel_mean_depid,
aes(x = factor(Begin_Hour_loc),
y = mean_diel)) +
geom_pointrange(aes(ymin = sd_lower,
ymax = sd_upper,
group = npz_id.x,
color = ifelse(sd_lower <= 0, 'firebrick','blue')),
size = 0.25,
show.legend = FALSE) +
geom_hline(yintercept = 0,
linetype = 3, # dotted line
colour = "black") +
scale_color_manual(values = c("red","black"))+
labs(y = "Mean-adjusted average N vessels / hour",
x = "Hour of Day (Local TZ)")+
facet_nested(rows = vars(network.x, npz_id.x, Dep_ID.x),
nest_line = element_line(),
scales = "free_y") +
theme(
axis.text.x = element_text(face = "bold"),
strip.background = element_blank(),
strip.text.y = element_text(face = "bold")
)
ggsave(paste0("figs/", "Diel_mean_adj_dep_presonly.png"), width=8, height=10, units="in", dpi=300)
# start by getting daily counts
all_ves_wkdy <- all_sites_hp |>
group_by(network, npz_id, Dep_ID, Dep, Date_week, Weekday, Begin_Date_loc)|>
# get daily vessel counts per weekday: total, inside, inside_small, maneuver, maneuver_small
summarise(Total_ves_dep = sum(Total_Vessels, na.rm = TRUE),
Total_inside = sum(total_inside, na.rm = TRUE),
Total_inside_small = sum(total_inside_small, na.rm = TRUE),
Inside_maneuver = sum(man_inside, na.rm = TRUE),
Inside_maneuver_small = sum(man_inside_small, na.rm = TRUE)) |>
mutate(Inside_transit = Total_inside - Inside_maneuver,
Inside_transit_small = Total_inside_small - Inside_maneuver_small,
Weekday = factor(Weekday, levels=c("Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday")),
network = case_when(npz_id == "CGMP" | npz_id == "SIMP" ~ "Temperate East",
npz_id == "DMP" | npz_id == "NMP" ~ "Northwest", TRUE ~ "South-west"
),
network = factor(network, levels = c("Temperate East","Northwest","South-west")))
levels(all_ves_wkdy$Weekday) <- c("M","T","W","R","F","Sa","Su")
# Calculate mean daily presence for each week per category
wkly_means <- all_ves_wkdy |>
group_by(network, npz_id, Dep_ID, Dep, Date_week) |>
summarize(n_days = n(),
mean_tot = mean(Total_ves_dep, na.rm = TRUE),
mean_ins = mean(Total_inside, na.rm = TRUE),
mean_ins_sm = mean(Total_inside_small, na.rm = TRUE),
mean_trans = mean(Inside_transit, na.rm = TRUE),
mean_trans_sm = mean(Inside_transit_small, na.rm = TRUE),
mean_man = mean(Inside_maneuver, na.rm = TRUE),
mean_man_sm = mean(Inside_maneuver_small, na.rm = TRUE))
# join weekly means to full weekday dataset
wkdy_mean_adj <- all_ves_wkdy |>
left_join(wkly_means, by = c("Date_week", "Dep")) |>
group_by(network.x, npz_id.x, Dep_ID.x, Weekday) |>
# only keep full weeks (7 days) and weeks with any vessels present
filter(n_days == 7,
mean_tot > 0) |>
# mean-adjusted value = count per weekday - weekly mean
mutate(tot_wk_adj = Total_ves_dep - mean_tot,
ins_wk_adj = Total_inside - mean_ins,
ins_sm_adj = Total_inside_small - mean_ins_sm) |>
summarise(mean_wk = mean(tot_wk_adj, na.rm = TRUE),
mean_wk_ins = mean(ins_wk_adj, na.rm = TRUE),
mean_wk_ins_sm = mean(ins_sm_adj, na.rm = TRUE)) |>
mutate(sd_lower = mean_wk - 0.5*(sd(mean_wk)),
sd_upper = mean_wk + 0.5*(sd(mean_wk)),
sd_lower_ins = mean_wk_ins - 0.5*(sd(mean_wk_ins)),
sd_upper_ins = mean_wk_ins + 0.5*(sd(mean_wk_ins)),
sd_lower_ins_sm = mean_wk_ins - 0.5*(sd(mean_wk_ins)),
sd_upper_ins_sm = mean_wk_ins_sm + 0.5*(sd(mean_wk_ins_sm)),
npz_id.x = fct(npz_id.x),
npz_id.x = fct_relevel(npz_id.x, c("CGMP","SIMP","DMP","NMP")))
ggplot(data = wkdy_mean_adj,
aes(x = Weekday, y = mean_wk)) +
geom_pointrange(aes(ymin = sd_lower,
ymax = sd_upper,
group = npz_id.x,
color = ifelse(sd_lower <= 0, 'firebrick','blue')),
size = 0.25,
show.legend = FALSE) +
geom_hline(yintercept = 0,
linetype = 3, # dotted line
colour = "black") +
scale_color_manual(values = c("red","black"))+
labs(y = "Mean-adjusted average N vessels / weekday",
x = "Weekday")+
facet_nested(rows = vars(network.x, npz_id.x, Dep_ID.x),
nest_line = element_line(),
scales = "free_y") +
theme(
axis.text.x = element_text(face = "bold"),
strip.background = element_blank(),
strip.text.y = element_text(face = "bold")
)
ggsave(paste0("figs/", "Weekday_mean_adj_dep_presentonly.png"), width=6, height=10, units="in", dpi=300)
