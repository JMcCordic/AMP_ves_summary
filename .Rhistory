# only keep weeks with presence
filter(n_days == 7,
week_sum > 0) |>
# get original weekday counts
left_join(all_ves_wkdy) |>
# re-group to week level
group_by(network, npz_id, Dep_ID, Dep, Date_week) |>
# calculate weekly mean of total presence for days with presence
mutate(mean_tot = mean(Total_inside, na.rm = TRUE),
mean_man = mean(Inside_maneuver, na.rm = TRUE),
# calculate mean-adjusted counts per weekday
tot_wkdy_adj = Total_inside - mean_tot,
man_wkdy_adj = Inside_maneuver - mean_man) |>
group_by(network, npz_id, Dep_ID, Weekday) |>
# get mean of mean-adjusted counts for each weekday
summarise(mean_wkdy_adj = mean(tot_wkdy_adj, na.rm = TRUE),
mean_man_wkdy_adj = mean(man_wkdy_adj, na.rm = TRUE)) |>
# get lower & upper bounds of SD of the mean of the adjusted counts
mutate(sd_lower = mean_wkdy_adj - 0.5*(sd(mean_wkdy_adj)),
sd_upper = mean_wkdy_adj + 0.5*(sd(mean_wkdy_adj)),
man_sd_lower = mean_man_wkdy_adj - 0.5*(sd(mean_man_wkdy_adj)),
man_sd_upper = mean_man_wkdy_adj + 0.5*(sd(mean_man_wkdy_adj)))
# Weekly mean-adjusted counts, inside and inside maneuvers
wkly_means_ins_man <- all_ves_wkdy |>
# group to week level
group_by(network, npz_id, Dep_ID, Dep, Date_week) |>
# get n_days per week in dataset
summarize(n_days = n(),
week_sum = sum(Inside_maneuver, na.rm = TRUE)) |>
# only keep full weeks n_days == 7
# only keep weeks with presence
filter(n_days == 7,
week_sum > 0) |>
# get original weekday counts
left_join(all_ves_wkdy) |>
# re-group to week level
group_by(network, npz_id, Dep_ID, Dep, Date_week) |>
# calculate weekly mean of total presence for days with presence
mutate(mean_man = mean(Inside_maneuver, na.rm = TRUE),
# calculate mean-adjusted counts per weekday
man_wkdy_adj = Inside_maneuver - mean_man) |>
group_by(network, npz_id, Dep_ID, Weekday) |>
# get mean of mean-adjusted counts for each weekday
summarise(mean_man_wkdy_adj = mean(man_wkdy_adj, na.rm = TRUE)) |>
# get lower & upper bounds of SD of the mean of the adjusted counts
mutate(man_sd_lower = mean_man_wkdy_adj - 0.5*(sd(mean_man_wkdy_adj)),
man_sd_upper = mean_man_wkdy_adj + 0.5*(sd(mean_man_wkdy_adj)))
# Weekly mean-adjusted counts, inside small only
wkly_means_ins_small <- all_ves_wkdy |>
# group to week level
group_by(network, npz_id, Dep_ID, Dep, Date_week) |>
# get n_days per week in dataset
summarize(n_days = n(),
week_sum = sum(Total_inside_small, na.rm = TRUE)) |>
# only keep full weeks n_days == 7
# only keep weeks with presence
filter(n_days == 7,
week_sum > 0) |>
# get original weekday counts
left_join(all_ves_wkdy) |>
# re-group to week level
group_by(network, npz_id, Dep_ID, Dep, Date_week) |>
# calculate weekly mean of total presence for days with presence
mutate(mean_tot = mean(Total_inside_small, na.rm = TRUE),
# calculate mean-adjusted counts per weekday
tot_wkdy_adj = Total_inside_small - mean_tot) |>
group_by(network, npz_id, Dep_ID, Weekday) |>
# get mean of mean-adjusted counts for each weekday
summarise(mean_wkdy_adj = mean(tot_wkdy_adj, na.rm = TRUE)) |>
# get lower & upper bounds of SD of the mean of the adjusted counts
mutate(sd_lower = mean_wkdy_adj - 0.5*(sd(mean_wkdy_adj)),
sd_upper = mean_wkdy_adj + 0.5*(sd(mean_wkdy_adj)))
ggplot(data = wkly_means_tot,
aes(x = Weekday, y = mean_wkdy_adj)) +
geom_line(aes(group = Dep_ID),
color = "gray70")+
geom_pointrange(aes(ymin = sd_lower,
ymax = sd_upper,
group = npz_id,
color = ifelse(sd_lower <= 0, 'firebrick','blue')),
size = 0.25,
show.legend = FALSE) +
geom_hline(yintercept = 0,
linetype = 3, # dotted line
colour = "black") +
scale_color_manual(values = c("red","black"))+
labs(title = "Total vessels",
y = "Mean-adjusted average N vessels / weekday",
x = "Weekday")+
facet_nested(rows = vars(network, npz_id, Dep_ID),
nest_line = element_line(),
scales = "free_y") +
theme(
axis.text.x = element_text(face = "bold"),
strip.background = element_blank(),
strip.text.y = element_text(face = "bold")
)
ggsave(paste0("figs/", "Weekday_mean_adj_dep_presentonly.png"), width=5, height=12, units="in", dpi=300)
# Inside vessels
ggplot(data = wkly_means_ins,
aes(x = Weekday, y = mean_wkdy_adj)) +
# geom_line(aes(group = Dep_ID),
#           color = "gray70")+
geom_pointrange(aes(ymin = sd_lower,
ymax = sd_upper,
group = npz_id,
color = ifelse(sd_lower <= 0, 'firebrick','blue')),
size = 0.25,
show.legend = FALSE) +
geom_hline(yintercept = 0,
linetype = 3, # dotted line
colour = "black") +
scale_color_manual(values = c("red","black"))+
labs(title = "Inside vessels",
y = "Mean-adjusted average N vessels / weekday",
x = "Weekday")+
facet_nested(rows = vars(network, npz_id, Dep_ID),
nest_line = element_line(),
scales = "free_y") +
theme(
axis.text.x = element_text(face = "bold"),
strip.background = element_blank(),
strip.text.y = element_text(face = "bold")
)
ggsave(paste0("figs/", "Weekday_mean_adj_dep_presentonly_inside.png"), width=5, height=12, units="in", dpi=300)
# Inside maneuvers only
# Inside vessels
ggplot(data = wkly_means_ins_man,
aes(x = Weekday, y = mean_man_wkdy_adj)) +
# geom_line(aes(group = Dep_ID),
#           color = "gray70")+
geom_pointrange(aes(ymin = man_sd_lower,
ymax = man_sd_upper,
group = npz_id,
color = ifelse(man_sd_lower <= 0, 'firebrick','blue')),
size = 0.25,
show.legend = FALSE) +
geom_hline(yintercept = 0,
linetype = 3, # dotted line
colour = "black") +
scale_color_manual(values = c("red","black"))+
labs(title = "Inside maneuvers",
y = "Mean-adjusted average N vessels / weekday",
x = "Weekday")+
facet_nested(rows = vars(network, npz_id, Dep_ID),
nest_line = element_line(),
scales = "free_y") +
theme(
axis.text.x = element_text(face = "bold"),
strip.background = element_blank(),
strip.text.y = element_text(face = "bold")
)
ggsave(paste0("figs/", "Weekday_mean_adj_dep_presentonly_insideman.png"), width=5, height=12, units="in", dpi=300)
# Inside small vessels
ggplot(data = wkly_means_ins_small,
aes(x = Weekday, y = mean_wkdy_adj)) +
# geom_line(aes(group = Dep_ID),
#           color = "gray70")+
geom_pointrange(aes(ymin = sd_lower,
ymax = sd_upper,
group = npz_id,
color = ifelse(sd_lower <= 0, 'firebrick','blue')),
size = 0.25,
show.legend = FALSE) +
geom_hline(yintercept = 0,
linetype = 3, # dotted line
colour = "black") +
scale_color_manual(values = c("red","black"))+
labs(title = "Inside small vessels",
y = "Mean-adjusted average N vessels / weekday",
x = "Weekday")+
facet_nested(rows = vars(network, npz_id, Dep_ID),
nest_line = element_line(),
scales = "free_y") +
theme(
axis.text.x = element_text(face = "bold"),
strip.background = element_blank(),
strip.text.y = element_text(face = "bold")
)
ggsave(paste0("figs/", "Weekday_mean_adj_dep_presentonly_inside_small.png"), width=5, height=12, units="in", dpi=300)
# Inside vessels
ggplot(data = wkly_means_ins,
aes(x = Weekday, y = mean_wkdy_adj)) +
geom_line(aes(group = Dep_ID),
color = "gray70")+
geom_pointrange(aes(ymin = sd_lower,
ymax = sd_upper,
group = npz_id,
color = ifelse(sd_lower <= 0, 'firebrick','blue')),
size = 0.25,
show.legend = FALSE) +
geom_hline(yintercept = 0,
linetype = 3, # dotted line
colour = "black") +
scale_color_manual(values = c("red","black"))+
labs(title = "Inside vessels",
y = "Mean-adjusted average N vessels / weekday",
x = "Weekday")+
facet_nested(rows = vars(network, npz_id, Dep_ID),
nest_line = element_line(),
scales = "free_y") +
theme(
axis.text.x = element_text(face = "bold"),
strip.background = element_blank(),
strip.text.y = element_text(face = "bold")
)
ggsave(paste0("figs/", "Weekday_mean_adj_dep_presentonly_inside.png"), width=5, height=12, units="in", dpi=300)
# Inside maneuvers only
# Inside vessels
ggplot(data = wkly_means_ins_man,
aes(x = Weekday, y = mean_man_wkdy_adj)) +
geom_line(aes(group = Dep_ID),
color = "gray70")+
geom_pointrange(aes(ymin = man_sd_lower,
ymax = man_sd_upper,
group = npz_id,
color = ifelse(man_sd_lower <= 0, 'firebrick','blue')),
size = 0.25,
show.legend = FALSE) +
geom_hline(yintercept = 0,
linetype = 3, # dotted line
colour = "black") +
scale_color_manual(values = c("red","black"))+
labs(title = "Inside maneuvers",
y = "Mean-adjusted average N vessels / weekday",
x = "Weekday")+
facet_nested(rows = vars(network, npz_id, Dep_ID),
nest_line = element_line(),
scales = "free_y") +
theme(
axis.text.x = element_text(face = "bold"),
strip.background = element_blank(),
strip.text.y = element_text(face = "bold")
)
ggsave(paste0("figs/", "Weekday_mean_adj_dep_presentonly_insideman.png"), width=5, height=12, units="in", dpi=300)
# Inside small vessels
ggplot(data = wkly_means_ins_small,
aes(x = Weekday, y = mean_wkdy_adj)) +
geom_line(aes(group = Dep_ID),
color = "gray70")+
geom_pointrange(aes(ymin = sd_lower,
ymax = sd_upper,
group = npz_id,
color = ifelse(sd_lower <= 0, 'firebrick','blue')),
size = 0.25,
show.legend = FALSE) +
geom_hline(yintercept = 0,
linetype = 3, # dotted line
colour = "black") +
scale_color_manual(values = c("red","black"))+
labs(title = "Inside small vessels",
y = "Mean-adjusted average N vessels / weekday",
x = "Weekday")+
facet_nested(rows = vars(network, npz_id, Dep_ID),
nest_line = element_line(),
scales = "free_y") +
theme(
axis.text.x = element_text(face = "bold"),
strip.background = element_blank(),
strip.text.y = element_text(face = "bold")
)
ggsave(paste0("figs/", "Weekday_mean_adj_dep_presentonly_inside_small.png"), width=5, height=12, units="in", dpi=300)
# start by getting hourly counts
all_ves_diel <- all_sites_hp |>
group_by(network, npz_id, Dep_ID, Dep, Begin_Date_loc, Begin_Hour_loc)|>
# get daily vessel counts per weekday: total, inside, inside_small, maneuver, maneuver_small
summarise(Total_ves_dep = sum(Total_Vessels, na.rm = TRUE),
Total_inside = sum(total_inside, na.rm = TRUE),
Total_inside_small = sum(total_inside_small, na.rm = TRUE),
Inside_maneuver = sum(man_inside, na.rm = TRUE),
Inside_maneuver_small = sum(man_inside_small, na.rm = TRUE)) |>
mutate(Inside_transit = Total_inside - Inside_maneuver,
Inside_transit_small = Total_inside_small - Inside_maneuver_small,
# Weekday = factor(Weekday, levels=c("Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday")),
network = case_when(npz_id == "CGMP" | npz_id == "SIMP" ~ "Temperate East",
npz_id == "DMP" | npz_id == "NMP" ~ "Northwest", TRUE ~ "South-west"
),
network = factor(network, levels = c("Temperate East","Northwest","South-west")))
# Calculate daily mean-adjusted counts per hour
daily_means_tot <- all_ves_diel |>
# group to date level
group_by(network, npz_id, Dep_ID, Dep, Begin_Date_loc) |>
# get n_hours per day
summarize(n_hrs = n(),
# and total vessels per day
day_sum = sum(Total_ves_dep, na.rm = TRUE)) |>
# only keep full days n_hrs == 24
# and days with vessels present
filter(n_hrs == 24,
day_sum >0) |>
# join to get hourly counts back
left_join(all_ves_diel) |>
# re-group to daily level
group_by(network, npz_id, Dep_ID, Dep, Begin_Date_loc) |>
# calculate mean total presence per day with vessels
mutate(mean_tot = mean(Total_ves_dep, na.rm = TRUE),
# calculate mean-adjusted counts per hour
tot_diel_adj = Total_ves_dep - mean_tot) |>
# group to hour level per deployment
group_by(network, npz_id, Dep_ID, Begin_Hour_loc) |>
# get mean of mean-adjusted ounts per hour
summarise(mean_diel_adj = mean(tot_diel_adj, na.rm =TRUE)) |>
# get lower & upper bounds for SD around mean of adjusted counts
mutate(sd_lower = mean_diel_adj - 0.5*(sd(mean_diel_adj)),
sd_upper = mean_diel_adj + 0.5*(sd(mean_diel_adj)))
# Calculate daily mean-adjusted counts per hour
daily_means_ins <- all_ves_diel |>
# group to date level
group_by(network, npz_id, Dep_ID, Dep, Begin_Date_loc) |>
# get n_hours per day
summarize(n_hrs = n(),
# and total vessels per day
day_sum = sum(Total_inside, na.rm = TRUE)) |>
# only keep full days n_hrs == 24
# and days with vessels present
filter(n_hrs == 24,
day_sum > 0) |>
# join to get hourly counts back
left_join(all_ves_diel) |>
# re-group to daily level
group_by(network, npz_id, Dep_ID, Dep, Begin_Date_loc) |>
# calculate mean total presence per day with vessels
mutate(mean_ins = mean(Total_inside, na.rm = TRUE),
# calculate mean-adjusted counts per hour
ins_diel_adj = Total_inside - mean_ins) |>
# group to hour level per deployment
group_by(network, npz_id, Dep_ID, Begin_Hour_loc) |>
# get mean of mean-adjusted ounts per hour
summarise(mean_diel_adj = mean(ins_diel_adj, na.rm =TRUE)) |>
# get lower & upper bounds for SD around mean of adjusted counts
mutate(sd_lower = mean_diel_adj - 0.5*(sd(mean_diel_adj)),
sd_upper = mean_diel_adj + 0.5*(sd(mean_diel_adj)))
# mean_tot = mean(Total_ves_dep, na.rm = TRUE),
# mean_ins = mean(Total_inside, na.rm = TRUE),
# mean_ins_sm = mean(Total_inside_small, na.rm = TRUE),
# mean_trans = mean(Inside_transit, na.rm = TRUE),
# mean_trans_sm = mean(Inside_transit_small, na.rm = TRUE),
# mean_man = mean(Inside_maneuver, na.rm = TRUE),
# mean_man_sm = mean(Inside_maneuver_small, na.rm = TRUE))
#
# diel_mean_depid <- all_ves_diel |>
#   left_join(daily_means, by = c("Begin_Date_loc", "Dep"), keep = FALSE) |>
#   group_by(network.x, npz_id.x, Dep_ID.x, Begin_Hour_loc) |>
#   filter(n_hrs == 24, # only keep full days
#          # only keep days with presence for mean-adjusting
#          mean_tot > 0) |>
#   mutate(tot_diel_adj = Total_ves_dep - mean_tot,
#          ins_diel_adj = Total_inside - mean_ins,
#          ins_sm_adj = Total_inside_small - mean_ins_sm) |>
#   summarise(mean_diel = mean(tot_diel_adj, na.rm = TRUE),
#             mean_diel_ins = mean(ins_diel_adj, na.rm = TRUE),
#             mean_diel_ins_sm = mean(ins_sm_adj, na.rm = TRUE)) |>
#   mutate(sd_lower = mean_diel - 0.5*(sd(mean_diel)),
#          sd_upper = mean_diel + 0.5*(sd(mean_diel)),
#          sd_lower_ins = mean_diel_ins - 0.5*(sd(mean_diel_ins)),
#          sd_upper_ins = mean_diel_ins + 0.5*(sd(mean_diel_ins)),
#          sd_lower_ins_sm = mean_diel_ins - 0.5*(sd(mean_diel_ins)),
#          sd_upper_ins_sm = mean_diel_ins_sm + 0.5*(sd(mean_diel_ins_sm)))
# plot total vessels
ggplot(data = daily_means_tot,
aes(x = Begin_Hour_loc,
y = mean_diel_adj)) +
geom_line(aes(group = Dep_ID),
color = "gray70")+
geom_pointrange(aes(ymin = sd_lower,
ymax = sd_upper,
group = npz_id,
color = ifelse(sd_lower <= 0, 'firebrick','blue')),
size = 0.25,
show.legend = FALSE) +
geom_hline(yintercept = 0,
linetype = 3, # dotted line
colour = "black") +
scale_color_manual(values = c("red","black"))+
scale_x_continuous(breaks = seq(0,23,2))+
labs(y = "Mean-adjusted average N vessels / hour",
x = "Hour of Day (Local TZ)",
title = "Total vessels")+
facet_nested(rows = vars(network, npz_id, Dep_ID),
nest_line = element_line(),
scales = "free_y") +
theme(
axis.text.x = element_text(face = "bold"),
strip.background = element_blank(),
strip.text.y = element_text(face = "bold")
)
ggsave(paste0("figs/", "Diel_mean_adj_dep_presonly_withline.png"), width=8, height=12, units="in", dpi=300)
# Plot inside vessels
# plot total vessels
ggplot(data = daily_means_ins,
aes(x = Begin_Hour_loc,
y = mean_diel_adj)) +
geom_pointrange(aes(ymin = sd_lower,
ymax = sd_upper,
group = npz_id,
color = ifelse(sd_lower <= 0, 'firebrick','blue')),
size = 0.25,
show.legend = FALSE) +
geom_hline(yintercept = 0,
linetype = 3, # dotted line
colour = "black") +
scale_color_manual(values = c("red","black"))+
scale_x_continuous(breaks = seq(0,23,2))+
labs(y = "Mean-adjusted average N vessels / hour",
x = "Hour of Day (Local TZ)",
title = "Inside vessels")+
facet_nested(rows = vars(network, npz_id, Dep_ID),
nest_line = element_line(),
scales = "free_y") +
theme(
axis.text.x = element_text(face = "bold"),
strip.background = element_blank(),
strip.text.y = element_text(face = "bold")
)
ggsave(paste0("figs/", "Diel_mean_adj_dep_presonly_ins.png"), width=8, height=12, units="in", dpi=300)
# # summarize to npz level
# diel_mean_adj_npz <- all_ves_diel |>
#   left_join(daily_means, by = c("Begin_Date_loc", "Dep"), keep = FALSE) |>
#   group_by(network.x, npz_id.x, Begin_Hour_loc) |>
#   mutate(tot_diel_adj = Total_ves_dep - mean_tot,
#          ins_diel_adj = Total_inside - mean_ins,
#          ins_sm_adj = Total_inside_small - mean_ins_sm) |>
#   summarise(mean_diel = mean(tot_diel_adj, na.rm = TRUE),
#             mean_diel_ins = mean(ins_diel_adj, na.rm = TRUE),
#             mean_diel_ins_sm = mean(ins_sm_adj, na.rm = TRUE)) |>
#   mutate(sd_lower = mean_diel - 0.5*(sd(mean_diel)),
#          sd_upper = mean_diel + 0.5*(sd(mean_diel)),
#          sd_lower_ins = mean_diel_ins - 0.5*(sd(mean_diel_ins)),
#          sd_upper_ins = mean_diel_ins + 0.5*(sd(mean_diel_ins)),
#          sd_lower_ins_sm = mean_diel_ins - 0.5*(sd(mean_diel_ins)),
#          sd_upper_ins_sm = mean_diel_ins_sm + 0.5*(sd(mean_diel_ins_sm)))
#
#
# ggplot(data = diel_mean_npz,
#        aes(x = factor(Begin_Hour_loc),
#            y = mean_diel)) +
#   geom_hline(yintercept = 0, colour = "grey50") +
#   geom_pointrange(aes(ymin = sd_lower,
#                       ymax = sd_upper,
#                       group = npz_id.x,
#                       color = ifelse(sd_lower <= 0, 'firebrick','blue')),
#                   size = 0.25,
#                   show.legend = FALSE) +
#   geom_hline(yintercept = 0,
#              linetype = 3, # dotted line
#              colour = "black") +
#   scale_color_manual(values = c("red","black"))+
#   labs(y = "Mean-adjusted average N vessels / hour",
#        x = "Hour of Day (Local TZ)")+
#    facet_nested(rows = vars(network.x, npz_id.x),
#                nest_line = element_line(),
#                scales = "free_y") +
#   theme(
#     axis.text.x = element_text(face = "bold"),
#     strip.background = element_blank(),
#     strip.text.y = element_text(face = "bold")
#     )
#
# ggsave(paste0("figs/", "Diel_mean_adj_npz_presonly.png"), width=8, height=10, units="in", dpi=300)
# Inside small vessels
#
# ggplot(data = diel_mean_npz |> filter(npz_id.x != "SWCMP"),
#        aes(x = factor(Begin_Hour_loc),
#            y = mean_diel_ins_sm)) +
#   geom_hline(yintercept = 0, colour = "grey50") +
#   geom_pointrange(aes(ymin = sd_lower_ins_sm,
#                       ymax = sd_upper_ins_sm,
#                       group = npz_id.x,
#                       color = ifelse(mean_diel_ins_sm < 0, 'firebrick','blue')),
#                   size = 0.25,
#                   show.legend = FALSE) +
#   scale_color_viridis_d(begin = 0.3, end = 0.7,
#                         option = "H",
#                         direction = -1)+
#   labs(y = "Mean-adjusted average N vessels / hour",
#        x = "Hour of Day (Local TZ)")+
#   facet_grid(rows = vars(npz_id.x)) +
#   theme(
#     axis.text.x = element_text(face = "bold"),
#     strip.text.y = element_text(face = "bold")
#     )
#
# ggsave(paste0("figs/", "Diel_mean_adj_npz_ins_sm.png"), width=8, height=10, units="in", dpi=300)
# plot total vessels
ggplot(data = daily_means_ins,
aes(x = Begin_Hour_loc,
y = mean_diel_adj)) +
geom_line(aes(group = Dep_ID),
color = "gray70")+
geom_pointrange(aes(ymin = sd_lower,
ymax = sd_upper,
group = npz_id,
color = ifelse(sd_lower <= 0, 'firebrick','blue')),
size = 0.25,
show.legend = FALSE) +
geom_hline(yintercept = 0,
linetype = 3, # dotted line
colour = "black") +
scale_color_manual(values = c("red","black"))+
scale_x_continuous(breaks = seq(0,23,2))+
labs(y = "Mean-adjusted average N vessels / hour",
x = "Hour of Day (Local TZ)",
title = "Inside vessels")+
facet_nested(rows = vars(network, npz_id, Dep_ID),
nest_line = element_line(),
scales = "free_y") +
theme(
axis.text.x = element_text(face = "bold"),
strip.background = element_blank(),
strip.text.y = element_text(face = "bold")
)
ggsave(paste0("figs/", "Diel_mean_adj_dep_presonly_ins.png"), width=8, height=12, units="in", dpi=300)
